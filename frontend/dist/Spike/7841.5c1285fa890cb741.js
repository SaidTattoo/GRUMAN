"use strict";(self.webpackChunkSpike=self.webpackChunkSpike||[]).push([[7841],{7841:(ye,S,m)=>{m.r(S),m.d(S,{LOCALES_ROUTES:()=>xe});var C=m(177),r=m(9417),g=m(8834),p=m(5596),d=m(3719),_=m(9213),h=m(9631),v=m(2798),R=m(8032),f=m.n(R),e=m(3953),E=m(8949),F=m(8887),j=m(1357),x=m(446),N=m(1626);let T=(()=>{class t{constructor(o){this.http=o,this.apiUrl=x.c.apiUrl}getRegiones(){return this.http.get(`${this.apiUrl}regiones-comunas/regiones`)}getProvinciasByRegion(o){return this.http.get(`${this.apiUrl}regiones-comunas/provincias/${o}`)}getComunasByProvincia(o){return this.http.get(`${this.apiUrl}regiones-comunas/comunas/${o}`)}static#e=this.\u0275fac=function(a){return new(a||t)(e.KVO(N.Qq))};static#o=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),y=(()=>{class t{constructor(o){this.http=o,this.nominatimUrl="https://nominatim.openstreetmap.org/search"}geocodeAddress(o){return this.http.get(this.nominatimUrl,{params:{q:o,format:"json",addressdetails:"1",limit:"1",countrycodes:"CL"}})}searchAddress(o){return this.http.get(this.nominatimUrl,{params:{q:o,format:"json",addressdetails:"1",limit:"5",countrycodes:"CL"}})}static#e=this.\u0275fac=function(a){return new(a||t)(e.KVO(N.Qq))};static#o=this.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var L=m(6600);const D=(t,i)=>i.id,w=(t,i)=>i.region_id,P=(t,i)=>i.provincia_id,V=(t,i)=>i.comuna_id;function G(t,i){if(1&t&&(e.j41(0,"mat-option",10),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.Y8G("value",o.id),e.R7$(),e.SpI(" ",o.nombre," ")}}function B(t,i){1&t&&(e.j41(0,"mat-option",21),e.EFF(1,"Cargando regiones..."),e.k0s())}function U(t,i){if(1&t&&(e.j41(0,"mat-option",10),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.Y8G("value",o.region_id),e.R7$(),e.SpI(" ",o.region_nombre," ")}}function O(t,i){if(1&t&&(e.j41(0,"mat-option",10),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.Y8G("value",o.provincia_id),e.R7$(),e.SpI(" ",o.provincia_nombre," ")}}function q(t,i){if(1&t&&(e.j41(0,"mat-option",10),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.Y8G("value",o.comuna_id),e.R7$(),e.SpI(" ",o.comuna_nombre," ")}}let z=(()=>{class t{constructor(o,a,n,l,c,s){this.fb=o,this.localesService=a,this.router=n,this.clientesService=l,this.regionesComunasService=c,this.geocodingService=s,this.clientes=[],this.regiones=[],this.provincias=[],this.comunas=[],this.REGION_METROPOLITANA_ID=13,this.suggestions=[],this.localForm=this.fb.group({direccion:["",r.k0.required],region:["",r.k0.required],nombre_local:["",r.k0.required],provincia:[{value:"",disabled:!0},r.k0.required],comuna:[{value:"",disabled:!0},r.k0.required],clientId:["",r.k0.required],zona:[""],grupo:["",r.k0.required],referencia:[""],telefono:["",r.k0.required],email_local:["",[r.k0.required,r.k0.email]],email_encargado:["",[r.k0.required,r.k0.email]],nombre_encargado:["",r.k0.required],latitud:["",r.k0.required],longitud:["",r.k0.required],numeroLocal:["",r.k0.required],sobreprecio:[0,[r.k0.required,r.k0.min(0)]],valorPorLocal:[0,[r.k0.required,r.k0.min(0)]]}),this.getClientes(),this.cargarRegiones()}ngOnInit(){this.getClientes(),this.cargarRegiones()}getClientes(){this.clientesService.getClientes().subscribe(o=>{this.clientes=o.filter(a=>"GRUMAN"!==a.nombre)})}calculateCoordinates(){this.localForm.get("direccion"),this.comunas.find(l=>l.comuna_id===this.localForm.get("comuna")?.value),this.regiones.find(l=>l.region_id===this.localForm.get("region")?.value)}cargarRegiones(){this.regionesComunasService.getRegiones().subscribe({next:o=>{if(this.regiones=o.sort((a,n)=>a.region_nombre.includes("Metropolitana")?-1:n.region_nombre.includes("Metropolitana")?1:a.region_nombre.localeCompare(n.region_nombre)),this.regiones.length>0){const a=this.regiones.find(n=>n.region_nombre.includes("Metropolitana"));a&&(this.localForm.patchValue({region:a.region_id}),this.regionesComunasService.getProvinciasByRegion(a.region_id).subscribe({next:n=>{this.provincias=n},error:n=>{console.error("Error al cargar provincias:",n)}}))}},error:o=>{console.error("Error al cargar regiones:",o)}})}onRegionChange(o){const a=o.value;this.localForm.patchValue({provincia:"",comuna:""}),this.provincias=[],this.comunas=[],a?(this.localForm.get("provincia")?.enable(),this.regionesComunasService.getProvinciasByRegion(a).subscribe({next:n=>{this.provincias=n},error:n=>{console.error("Error al cargar provincias:",n)}})):(this.localForm.get("provincia")?.disable(),this.localForm.get("comuna")?.disable()),this.calculateCoordinates()}onProvinciaChange(o){const a=o.value;this.localForm.patchValue({comuna:""}),this.comunas=[],a?(this.localForm.get("comuna")?.enable(),this.regionesComunasService.getComunasByProvincia(a).subscribe({next:n=>{this.comunas=n},error:n=>{console.error("Error al cargar comunas:",n)}})):this.localForm.get("comuna")?.disable(),this.calculateCoordinates()}onSubmit(){this.calculateCoordinates(),this.localForm.get("provincia")?.enable(),this.localForm.get("comuna")?.enable();const o=this.localForm.get("clientId")?.value;let a=this.clientes.find(s=>s.id===o)?.nombre;const n=["y","de","la","el","los","las","del","al","en","por","con","para"];if(!a)return void console.error("Nombre del cliente no encontrado");a=a.split(" ").filter(b=>!n.includes(b.toLowerCase())).map(b=>b.charAt(0).toUpperCase()).join("");const c=`${a}-${Date.now().toString()}`;this.localForm.get("numeroLocal")?.setValue(c),this.localForm.valid&&f().fire({title:"\xbfEst\xe1s seguro que deseas crear este local?",text:"Por favor, espere...",allowOutsideClick:!1,showCancelButton:!0,confirmButtonText:"S\xed, crear",cancelButtonText:"Cancelar",reverseButtons:!0}).then(s=>{s.isConfirmed&&this.localesService.crearLocal(this.localForm.value).subscribe(b=>{this.router.navigate(["/mantenedores/locales"])})})}onDireccionChange(){this.calculateCoordinates()}onClienteChange(o){const a=o.value;let n=this.clientes.find(c=>c.id===a)?.nombre;const l=["y","de","la","el","los","las","del","al","en","por","con","para"];n&&(n=n.split(" ").filter(s=>!l.includes(s.toLowerCase())).map(s=>s.charAt(0).toUpperCase()).join(""))}onSearch(o){this.geocodingService.searchAddress(o.target.value).subscribe({next:n=>{this.suggestions=n},error:n=>{console.error("Error en autocompletar:",n)}})}onOptionSelected(o){const a=this.suggestions.find(n=>n.display_name===o.option.value);a&&this.localForm.patchValue({direccion:a.display_name,latitud:a.lat,longitud:a.lon})}onCancelar(){this.router.navigate(["/mantenedores/locales"])}static#e=this.\u0275fac=function(a){return new(a||t)(e.rXU(r.ok),e.rXU(E.R),e.rXU(F.Ix),e.rXU(j.T),e.rXU(T),e.rXU(y))};static#o=this.\u0275cmp=e.VBU({type:t,selectors:[["app-crear-local"]],standalone:!0,features:[e.aNF],decls:144,vars:6,consts:[[1,"cardWithShadow"],[1,"p-24"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-sm-6"],[1,"col-sm-4","d-flex","align-items-center"],[1,"mat-subtitle-2","f-w-600","d-block","m-b-16"],[1,"col-sm-8"],["appearance","outline",1,"w-100"],["placeholder","Seleccione un cliente","formControlName","clientId",3,"selectionChange"],[3,"value"],["matInput","","placeholder","Ingrese el nombre del local","formControlName","nombre_local"],["matInput","","placeholder","Ingrese el grupo","formControlName","grupo"],["matInput","","placeholder","Ingrese la referencia","formControlName","referencia"],["matInput","","placeholder","Ingrese el tel\xe9fono","formControlName","telefono"],["matInput","","placeholder","Ingrese el email del local","type","email","formControlName","email_local"],["matInput","","type","number","placeholder","Ingrese el sobreprecio","formControlName","sobreprecio"],["matSuffix",""],["matInput","","type","number","placeholder","Ingrese el valor por local","formControlName","valorPorLocal"],["matPrefix",""],["placeholder","Seleccione una regi\xf3n","formControlName","region",3,"selectionChange"],["disabled",""],["placeholder","Seleccione una provincia","formControlName","provincia",3,"selectionChange","disabled"],["placeholder","Seleccione una comuna","formControlName","comuna",3,"disabled"],["matInput","","placeholder","Ingrese la direcci\xf3n","formControlName","direccion",3,"change"],["matInput","","placeholder","Ingrese la zona","formControlName","zona"],["matInput","","placeholder","Ingrese el email del encargado","type","email","formControlName","email_encargado"],["matInput","","placeholder","Ingrese el nombre del encargado","formControlName","nombre_encargado"],["matInput","","placeholder","Ingrese la latitud","formControlName","latitud",3,"disabled"],["matInput","","placeholder","Ingrese la longitud","formControlName","longitud",3,"disabled"],[1,"row","justify-content-end"],["mat-flat-button","","color","primary","type","submit"],["mat-flat-button","","type","button",3,"click"]],template:function(a,n){1&a&&(e.j41(0,"mat-card",0)(1,"mat-card-content",1)(2,"form",2),e.bIt("ngSubmit",function(){return n.onSubmit()}),e.j41(3,"div",3)(4,"div",4)(5,"div",3)(6,"div",5)(7,"mat-label",6),e.EFF(8,"Cliente"),e.k0s()(),e.j41(9,"div",7)(10,"mat-form-field",8)(11,"mat-select",9),e.bIt("selectionChange",function(c){return n.onClienteChange(c)}),e.Z7z(12,G,2,2,"mat-option",10,D),e.k0s()()()(),e.j41(14,"div",3)(15,"div",5)(16,"mat-label",6),e.EFF(17,"Nombre Local"),e.k0s()(),e.j41(18,"div",7)(19,"mat-form-field",8),e.nrm(20,"input",11),e.k0s()()(),e.j41(21,"div",3)(22,"div",5)(23,"mat-label",6),e.EFF(24,"Grupo"),e.k0s()(),e.j41(25,"div",7)(26,"mat-form-field",8),e.nrm(27,"input",12),e.k0s()()(),e.j41(28,"div",3)(29,"div",5)(30,"mat-label",6),e.EFF(31,"Referencia"),e.k0s()(),e.j41(32,"div",7)(33,"mat-form-field",8),e.nrm(34,"input",13),e.k0s()()(),e.j41(35,"div",3)(36,"div",5)(37,"mat-label",6),e.EFF(38,"Tel\xe9fono"),e.k0s()(),e.j41(39,"div",7)(40,"mat-form-field",8),e.nrm(41,"input",14),e.k0s()()(),e.j41(42,"div",3)(43,"div",5)(44,"mat-label",6),e.EFF(45,"Email Local"),e.k0s()(),e.j41(46,"div",7)(47,"mat-form-field",8),e.nrm(48,"input",15),e.k0s()()(),e.j41(49,"div",3)(50,"div",5)(51,"mat-label",6),e.EFF(52,"Sobreprecio"),e.k0s()(),e.j41(53,"div",7)(54,"mat-form-field",8),e.nrm(55,"input",16),e.j41(56,"span",17),e.EFF(57,"%"),e.k0s()()()(),e.j41(58,"div",3)(59,"div",5)(60,"mat-label",6),e.EFF(61,"Valor por Local"),e.k0s()(),e.j41(62,"div",7)(63,"mat-form-field",8),e.nrm(64,"input",18),e.j41(65,"span",19),e.EFF(66,"$"),e.k0s()()()()(),e.j41(67,"div",4)(68,"div",3)(69,"div",5)(70,"mat-label",6),e.EFF(71,"Regi\xf3n"),e.k0s()(),e.j41(72,"div",7)(73,"mat-form-field",8)(74,"mat-select",20),e.bIt("selectionChange",function(c){return n.onRegionChange(c)}),e.DNE(75,B,2,0,"mat-option",21),e.Z7z(76,U,2,2,"mat-option",10,w),e.k0s()()()(),e.j41(78,"div",3)(79,"div",5)(80,"mat-label",6),e.EFF(81,"Provincia"),e.k0s()(),e.j41(82,"div",7)(83,"mat-form-field",8)(84,"mat-select",22),e.bIt("selectionChange",function(c){return n.onProvinciaChange(c)}),e.Z7z(85,O,2,2,"mat-option",10,P),e.k0s()()()(),e.j41(87,"div",3)(88,"div",5)(89,"mat-label",6),e.EFF(90,"Comuna"),e.k0s()(),e.j41(91,"div",7)(92,"mat-form-field",8)(93,"mat-select",23),e.Z7z(94,q,2,2,"mat-option",10,V),e.k0s()()()(),e.j41(96,"div",3)(97,"div",5)(98,"mat-label",6),e.EFF(99,"Direcci\xf3n"),e.k0s()(),e.j41(100,"div",7)(101,"mat-form-field",8)(102,"input",24),e.bIt("change",function(){return n.onDireccionChange()}),e.k0s()()()(),e.j41(103,"div",3)(104,"div",5)(105,"mat-label",6),e.EFF(106,"Zona"),e.k0s()(),e.j41(107,"div",7)(108,"mat-form-field",8),e.nrm(109,"input",25),e.k0s()()(),e.j41(110,"div",3)(111,"div",5)(112,"mat-label",6),e.EFF(113,"Email Encargado"),e.k0s()(),e.j41(114,"div",7)(115,"mat-form-field",8),e.nrm(116,"input",26),e.k0s()()(),e.j41(117,"div",3)(118,"div",5)(119,"mat-label",6),e.EFF(120,"Nombre Encargado"),e.k0s()(),e.j41(121,"div",7)(122,"mat-form-field",8),e.nrm(123,"input",27),e.k0s()()(),e.j41(124,"div",3)(125,"div",5)(126,"mat-label",6),e.EFF(127,"Latitud"),e.k0s()(),e.j41(128,"div",7)(129,"mat-form-field",8),e.nrm(130,"input",28),e.k0s()()(),e.j41(131,"div",3)(132,"div",5)(133,"mat-label",6),e.EFF(134,"Longitud"),e.k0s()(),e.j41(135,"div",7)(136,"mat-form-field",8),e.nrm(137,"input",29),e.k0s()()()()(),e.j41(138,"div",30)(139,"div",7)(140,"button",31),e.EFF(141,"Crear Local"),e.k0s(),e.j41(142,"button",32),e.bIt("click",function(){return n.onCancelar()}),e.EFF(143,"Volver"),e.k0s()()()()()()),2&a&&(e.R7$(2),e.Y8G("formGroup",n.localForm),e.R7$(10),e.Dyx(n.clientes),e.R7$(63),e.vxM(n.regiones.length?-1:75),e.R7$(),e.Dyx(n.regiones),e.R7$(8),e.Y8G("disabled",!n.provincias.length),e.R7$(),e.Dyx(n.provincias),e.R7$(8),e.Y8G("disabled",!n.comunas.length),e.R7$(),e.Dyx(n.comunas),e.R7$(36),e.Y8G("disabled",!0),e.R7$(7),e.Y8G("disabled",!0))},dependencies:[r.X1,r.qT,r.me,r.Q0,r.BC,r.cb,r.j4,r.JD,d.RG,d.rl,d.nJ,d.JW,d.yw,h.fS,h.fg,g.Hl,g.$z,p.Hu,p.RN,p.m2,_.m_,v.Ve,v.VO,L.wT,C.MD]})}return t})();var I=m(6695),u=m(9159),k=m(2288),$=m(4823),M=m(4006);const X=()=>[5,10,25,50];function Y(t,i){if(1&t&&(e.j41(0,"mat-option",8),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.Y8G("value",o.id),e.R7$(),e.SpI(" ",o.nombre," ")}}function A(t,i){1&t&&(e.j41(0,"th",37),e.EFF(1," Cliente "),e.k0s())}function H(t,i){if(1&t&&(e.j41(0,"td",38),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.client.nombre," ")}}function Z(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Nombre Local "),e.k0s())}function J(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.nombre_local," ")}}function W(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Direcci\xf3n "),e.k0s())}function Q(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.direccion," ")}}function K(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Comuna "),e.k0s())}function ee(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.comuna.comuna_nombre," ")}}function oe(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Regi\xf3n "),e.k0s())}function te(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.region.region_nombre||"-"," ")}}function ne(t,i){1&t&&(e.j41(0,"th",41),e.EFF(1," Sobreprecio "),e.k0s())}function ae(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.sobreprecio,"% ")}}function ie(t,i){1&t&&(e.j41(0,"th",41),e.EFF(1," Valor Local "),e.k0s())}function re(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.nI1(2,"number"),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" $",e.brH(2,1,o.valorPorLocal,"1.2-2","es-CL")," ")}}function le(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Tel\xe9fono "),e.k0s())}function ce(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.telefono," ")}}function se(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Email Local "),e.k0s())}function me(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.email_local," ")}}function de(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Email Encargado "),e.k0s())}function ue(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.email_encargado," ")}}function pe(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Latitud "),e.k0s())}function fe(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.latitud," ")}}function ge(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Longitud "),e.k0s())}function he(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.longitud," ")}}function ve(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Nombre Encargado "),e.k0s())}function be(t,i){if(1&t&&(e.j41(0,"td",40),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.R7$(),e.SpI(" ",o.nombre_encargado," ")}}function Ce(t,i){1&t&&(e.j41(0,"th",39),e.EFF(1," Acciones "),e.k0s())}function _e(t,i){if(1&t){const o=e.RV6();e.j41(0,"td",40)(1,"button",42),e.bIt("click",function(){const n=e.eBV(o).$implicit,l=e.XpG();return e.Njj(l.modalEditarLocal(n))}),e.j41(2,"mat-icon"),e.EFF(3,"edit"),e.k0s()(),e.j41(4,"button",43),e.bIt("click",function(){const n=e.eBV(o).$implicit,l=e.XpG();return e.Njj(l.deleteLocal(n.id))}),e.j41(5,"mat-icon"),e.EFF(6,"delete"),e.k0s()()()}}function Fe(t,i){1&t&&e.nrm(0,"tr",44)}function ke(t,i){1&t&&e.nrm(0,"tr",45)}let Ee=(()=>{class t{constructor(o,a,n,l,c){this.localesService=o,this.clientesService=a,this.dialog=n,this.router=l,this.fb=c,this.displayedColumns=["cliente","nombre_local","direccion","comuna","region","sobreprecio","valorPorLocal","telefono","email_local","email_encargado","nombre_encargado","latitud","longitud","acciones"],this.dataSource=new u.I6([]),this.totalLocales=0,this.pageSize=10,this.currentPage=0,this.clientes=[],this.filterForm=this.fb.group({search:[""],clientId:[""]})}ngOnInit(){this.loadClientes(),this.loadLocales(),this.filterForm.valueChanges.subscribe(()=>{this.currentPage=0,this.loadLocales()})}loadClientes(){this.clientesService.getClientes().subscribe({next:o=>{this.clientes=o},error:o=>{console.error("Error al cargar clientes:",o)}})}loadLocales(){const o=this.filterForm.value;this.localesService.getLocalesPaginados(this.currentPage+1,this.pageSize,o.clientId,o.search).subscribe({next:a=>{this.dataSource.data=a.data,this.totalLocales=a.total},error:a=>{console.error("Error al cargar locales:",a),f().fire("Error","No se pudieron cargar los locales","error")}})}onPageChange(o){this.currentPage=o.pageIndex,this.pageSize=o.pageSize,this.loadLocales()}resetFilters(){this.filterForm.reset(),this.currentPage=0,this.loadLocales()}modalEditarLocal(o){this.router.navigate(["/mantenedores/locales/editar",o.id])}modalNuevoLocal(){this.router.navigate(["/mantenedores/locales/crear"])}deleteLocal(o){f().fire({title:"\xbfEst\xe1s seguro?",text:"No podr\xe1s revertir esta acci\xf3n",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, eliminar",cancelButtonText:"Cancelar"}).then(a=>{a.isConfirmed&&this.localesService.deleteLocal(o).subscribe({next:()=>{this.loadLocales(),f().fire("Eliminado!","El local ha sido eliminado.","success")},error:n=>{console.error("Error al eliminar:",n),f().fire("Error!","No se pudo eliminar el local.","error")}})})}exportarExcel(){if(!this.dataSource||!this.dataSource.data||0===this.dataSource.data.length)return void f().fire({title:"No hay datos",text:"No hay locales para exportar",icon:"warning",confirmButtonText:"Aceptar"});const o=this.dataSource.data.map(s=>({Cliente:s.client?.nombre||"No asignado","Nombre Local":s.nombre_local||"No asignado",Direcci\u00f3n:s.direccion||"No asignado",Comuna:s.comuna?.comuna_nombre||"No asignado",Regi\u00f3n:s.region?.region_nombre||"No asignado",Sobreprecio:`${s.sobreprecio||0}%`,"Valor Local":s.valorPorLocal?`$${s.valorPorLocal.toLocaleString("es-CL")}`:"$0",Tel\u00e9fono:s.telefono||"No asignado","Email Local":s.email_local||"No asignado","Email Encargado":s.email_encargado||"No asignado","Nombre Encargado":s.nombre_encargado||"No asignado",Latitud:s.latitud||"No asignado",Longitud:s.longitud||"No asignado"})),a=k.Wp.book_new(),n=k.Wp.json_to_sheet(o);n["!cols"]=[{wch:30},{wch:30},{wch:40},{wch:20},{wch:25},{wch:15},{wch:15},{wch:15},{wch:30},{wch:30},{wch:30},{wch:15},{wch:15}],k.Wp.book_append_sheet(a,n,"Locales");const c=(new Date).toISOString().split("T")[0];k._h(a,`Locales_${c}.xlsx`),f().fire({title:"\xa1\xc9xito!",text:"El archivo Excel se ha descargado correctamente",icon:"success",timer:2e3,showConfirmButton:!1})}static#e=this.\u0275fac=function(a){return new(a||t)(e.rXU(E.R),e.rXU(j.T),e.rXU(M.bZ),e.rXU(F.Ix),e.rXU(r.ok))};static#o=this.\u0275cmp=e.VBU({type:t,selectors:[["app-locales"]],viewQuery:function(a,n){if(1&a&&e.GBs(I.iy,5),2&a){let l;e.mGM(l=e.lsd())&&(n.paginator=l.first)}},standalone:!0,features:[e.aNF],decls:78,vars:10,consts:[[1,"cardWithShadow"],[1,"spacer"],[1,"filter-form-inline",3,"formGroup"],["appearance","outline",1,"search-field"],["matInput","","formControlName","search","placeholder","Nombre, direcci\xf3n..."],["matSuffix",""],["appearance","outline",1,"client-field"],["formControlName","clientId"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","color","primary","matTooltip","Limpiar filtros",3,"click"],["mat-stroked-button","","color","primary","matTooltip","Exportar a Excel",3,"click"],["mat-raised-button","","color","primary",3,"click"],[1,"table-container"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","cliente"],["mat-header-cell","","class","f-w-600 mat-subtitle-1 f-s-14 p-l-0",4,"matHeaderCellDef"],["mat-cell","","class","p-l-0",4,"matCellDef"],["matColumnDef","nombre_local"],["mat-header-cell","","class","f-w-600 mat-subtitle-1 f-s-14",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","direccion"],["matColumnDef","comuna"],["matColumnDef","region"],["matColumnDef","sobreprecio"],["mat-header-cell","","class","f-w-600 mat-subtitle-1 f-s-14 min-w-100",4,"matHeaderCellDef"],["matColumnDef","valorPorLocal"],["matColumnDef","telefono"],["matColumnDef","email_local"],["matColumnDef","email_encargado"],["matColumnDef","latitud"],["matColumnDef","longitud"],["matColumnDef","nombre_encargado"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"page","length","pageSize","pageSizeOptions","pageIndex"],["mat-header-cell","",1,"f-w-600","mat-subtitle-1","f-s-14","p-l-0"],["mat-cell","",1,"p-l-0"],["mat-header-cell","",1,"f-w-600","mat-subtitle-1","f-s-14"],["mat-cell",""],["mat-header-cell","",1,"f-w-600","mat-subtitle-1","f-s-14","min-w-100"],["mat-icon-button","",3,"click"],["mat-icon-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(a,n){1&a&&(e.j41(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),e.EFF(3,"Locales"),e.k0s(),e.nrm(4,"div",1),e.j41(5,"form",2)(6,"mat-form-field",3)(7,"mat-label"),e.EFF(8,"Buscar"),e.k0s(),e.nrm(9,"input",4),e.j41(10,"mat-icon",5),e.EFF(11,"search"),e.k0s()(),e.j41(12,"mat-form-field",6)(13,"mat-label"),e.EFF(14,"Cliente"),e.k0s(),e.j41(15,"mat-select",7)(16,"mat-option",8),e.EFF(17,"Todos"),e.k0s(),e.DNE(18,Y,2,2,"mat-option",9),e.k0s()(),e.j41(19,"button",10),e.bIt("click",function(){return n.resetFilters()}),e.j41(20,"mat-icon"),e.EFF(21,"refresh"),e.k0s()(),e.j41(22,"button",11),e.bIt("click",function(){return n.exportarExcel()}),e.j41(23,"mat-icon"),e.EFF(24,"file_download"),e.k0s(),e.EFF(25," Exportar "),e.k0s(),e.j41(26,"button",12),e.bIt("click",function(){return n.modalNuevoLocal()}),e.j41(27,"mat-icon"),e.EFF(28,"add"),e.k0s(),e.EFF(29," Nuevo Local "),e.k0s()()(),e.j41(30,"mat-card-content")(31,"div",13)(32,"table",14),e.qex(33,15),e.DNE(34,A,2,0,"th",16)(35,H,2,1,"td",17),e.bVm(),e.qex(36,18),e.DNE(37,Z,2,0,"th",19)(38,J,2,1,"td",20),e.bVm(),e.qex(39,21),e.DNE(40,W,2,0,"th",19)(41,Q,2,1,"td",20),e.bVm(),e.qex(42,22),e.DNE(43,K,2,0,"th",19)(44,ee,2,1,"td",20),e.bVm(),e.qex(45,23),e.DNE(46,oe,2,0,"th",19)(47,te,2,1,"td",20),e.bVm(),e.qex(48,24),e.DNE(49,ne,2,0,"th",25)(50,ae,2,1,"td",20),e.bVm(),e.qex(51,26),e.DNE(52,ie,2,0,"th",25)(53,re,3,5,"td",20),e.bVm(),e.qex(54,27),e.DNE(55,le,2,0,"th",19)(56,ce,2,1,"td",20),e.bVm(),e.qex(57,28),e.DNE(58,se,2,0,"th",19)(59,me,2,1,"td",20),e.bVm(),e.qex(60,29),e.DNE(61,de,2,0,"th",19)(62,ue,2,1,"td",20),e.bVm(),e.qex(63,30),e.DNE(64,pe,2,0,"th",19)(65,fe,2,1,"td",20),e.bVm(),e.qex(66,31),e.DNE(67,ge,2,0,"th",19)(68,he,2,1,"td",20),e.bVm(),e.qex(69,32),e.DNE(70,ve,2,0,"th",19)(71,be,2,1,"td",20),e.bVm(),e.qex(72,33),e.DNE(73,Ce,2,0,"th",19)(74,_e,7,0,"td",20),e.bVm(),e.DNE(75,Fe,1,0,"tr",34)(76,ke,1,0,"tr",35),e.k0s(),e.j41(77,"mat-paginator",36),e.bIt("page",function(c){return n.onPageChange(c)}),e.k0s()()()()),2&a&&(e.R7$(5),e.Y8G("formGroup",n.filterForm),e.R7$(13),e.Y8G("ngForOf",n.clientes),e.R7$(14),e.Y8G("dataSource",n.dataSource),e.R7$(43),e.Y8G("matHeaderRowDef",n.displayedColumns),e.R7$(),e.Y8G("matRowDefColumns",n.displayedColumns),e.R7$(),e.Y8G("length",n.totalLocales)("pageSize",n.pageSize)("pageSizeOptions",e.lJ4(9,X))("pageIndex",n.currentPage))},dependencies:[C.MD,C.Sq,C.QX,p.Hu,p.RN,p.m2,p.MM,p.dh,u.tP,u.Zl,u.tL,u.ji,u.cC,u.YV,u.iL,u.KS,u.$R,u.YZ,u.NB,d.RG,d.rl,d.nJ,d.yw,h.fS,h.fg,g.Hl,g.$z,g.iY,_.m_,_.An,I.Ou,I.iy,v.Ve,v.VO,L.wT,r.X1,r.qT,r.me,r.BC,r.cb,r.j4,r.JD,$.uc,$.oV],styles:['@charset "UTF-8";.min-w-200[_ngcontent-%COMP%]{min-width:180px}.filter-form-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;flex-wrap:wrap}.search-field[_ngcontent-%COMP%]{width:250px}.client-field[_ngcontent-%COMP%]{width:200px}mat-card-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.table-container[_ngcontent-%COMP%]{overflow-x:auto;padding:4px 0;margin-top:8px}@media (max-width: 768px){.filter-form-inline[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.search-field[_ngcontent-%COMP%], .client-field[_ngcontent-%COMP%]{width:100%}}']})}return t})();var je=m(7468);const Le=(t,i)=>i.region_id,Ie=(t,i)=>i.provincia_id,Se=(t,i)=>i.comuna_id;function Ne(t,i){1&t&&(e.j41(0,"mat-option",21),e.EFF(1,"Cargando regiones..."),e.k0s())}function Te(t,i){if(1&t&&(e.j41(0,"mat-option",22),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.Y8G("value",o.region_id),e.R7$(),e.SpI(" ",o.region_nombre," ")}}function $e(t,i){if(1&t&&(e.j41(0,"mat-option",22),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.Y8G("value",o.provincia_id),e.R7$(),e.SpI(" ",o.provincia_nombre," ")}}function Re(t,i){if(1&t&&(e.j41(0,"mat-option",22),e.EFF(1),e.k0s()),2&t){const o=i.$implicit;e.Y8G("value",o.comuna_id),e.R7$(),e.SpI(" ",o.comuna_nombre," ")}}const xe=[{path:"",component:Ee,data:{title:"Locales"}},{path:"crear",component:z,data:{title:"Crear Local"}},{path:"editar/:id",component:(()=>{class t{constructor(o,a,n,l,c,s,b){this.fb=o,this.localesService=a,this.router=n,this.route=l,this.clientesService=c,this.regionesComunasService=s,this.cdr=b,this.clientes=[],this.regiones=[],this.provincias=[],this.comunas=[],this.localForm=this.fb.group({nombre_local:["",r.k0.required],direccion:["",r.k0.required],region:["",r.k0.required],provincia:[{value:"",disabled:!0},r.k0.required],comuna:[{value:"",disabled:!0},r.k0.required],client:["",r.k0.required],zona:[""],grupo:["",r.k0.required],referencia:[""],telefono:["",r.k0.required],email_local:["",[r.k0.required,r.k0.email]],email_encargado:["",[r.k0.required,r.k0.email]],nombre_encargado:["",r.k0.required],latitud:["",r.k0.required],longitud:["",r.k0.required],numeroLocal:["",r.k0.required],sobreprecio:[0,[r.k0.required,r.k0.min(0)]],valorPorLocal:[0,[r.k0.required,r.k0.min(0)]]})}ngOnInit(){this.localId=Number(this.route.snapshot.params.id),(0,je.p)({local:this.localesService.getLocalById(this.localId),clientes:this.clientesService.getClientes(),regiones:this.regionesComunasService.getRegiones()}).subscribe({next:({local:o,clientes:a,regiones:n})=>{this.clientes=a,this.regiones=n.sort((l,c)=>l.region_nombre.localeCompare(c.region_nombre)),this.regionesComunasService.getProvinciasByRegion(o.region.region_id).subscribe(l=>{this.provincias=l,this.localForm.get("provincia")?.enable(),this.regionesComunasService.getComunasByProvincia(o.provincia.provincia_id).subscribe(c=>{this.comunas=c,this.localForm.get("comuna")?.enable(),this.localForm.patchValue({region:o.region.region_id,provincia:o.provincia.provincia_id,comuna:o.comuna.comuna_id,nombre_local:o.nombre_local,direccion:o.direccion,client:o.client.id,zona:o.zona,grupo:o.grupo,referencia:o.referencia,telefono:o.telefono,email_local:o.email_local,email_encargado:o.email_encargado,nombre_encargado:o.nombre_encargado,latitud:o.latitud,longitud:o.longitud,numeroLocal:o.numeroLocal,sobreprecio:o.sobreprecio,valorPorLocal:o.valorPorLocal}),this.cdr.detectChanges()})})},error:o=>{console.error("Error al cargar datos:",o),f().fire("Error","No se pudieron cargar los datos","error")}})}getClientes(){this.clientesService.getClientes().subscribe(o=>{console.log("****",o),this.clientes=o})}cargarRegiones(){this.regionesComunasService.getRegiones().subscribe({next:o=>{if(this.regiones=o.sort((a,n)=>a.region_nombre.includes("Metropolitana")?-1:n.region_nombre.includes("Metropolitana")?1:a.region_nombre.localeCompare(n.region_nombre)),this.regiones.length>0){const a=this.regiones.find(n=>n.region_nombre.includes("Metropolitana"));a&&(this.localForm.patchValue({region:a.region_id}),this.regionesComunasService.getProvinciasByRegion(a.region_id).subscribe({next:n=>{this.provincias=n},error:n=>{console.error("Error al cargar provincias:",n)}}))}},error:o=>{console.error("Error al cargar regiones:",o)}})}onRegionChange(o){const a=o.value;this.localForm.patchValue({provincia:"",comuna:""}),this.provincias=[],this.comunas=[],a?(this.localForm.get("provincia")?.enable(),this.regionesComunasService.getProvinciasByRegion(a).subscribe({next:n=>{this.provincias=n},error:n=>{console.error("Error al cargar provincias:",n)}})):(this.localForm.get("provincia")?.disable(),this.localForm.get("comuna")?.disable())}onProvinciaChange(o){const a=o.value;this.localForm.patchValue({comuna:""}),this.comunas=[],a?(this.localForm.get("comuna")?.enable(),this.regionesComunasService.getComunasByProvincia(a).subscribe({next:n=>{this.comunas=n},error:n=>{console.error("Error al cargar comunas:",n)}})):this.localForm.get("comuna")?.disable()}onSubmit(){this.localForm.get("provincia")?.enable(),this.localForm.get("comuna")?.enable(),this.localForm.valid&&f().fire({title:"\xbfEst\xe1s seguro que deseas actualizar este local?",text:"Por favor, espere...",allowOutsideClick:!1,showCancelButton:!0,confirmButtonText:"S\xed, actualizar",cancelButtonText:"Cancelar",reverseButtons:!0}).then(o=>{o.isConfirmed&&this.localesService.updateLocal(this.localId,this.localForm.value).subscribe({next:a=>{f().fire("\xc9xito","Local actualizado correctamente","success"),this.router.navigate(["/mantenedores/locales"])},error:a=>{console.error("Error al actualizar:",a),f().fire("Error","No se pudo actualizar el local","error")}})})}onClienteChange(o){let n=this.clientes.find(c=>c.id===this.localForm.get("client")?.value)?.nombre;const l=["y","de","la","el","los","las","del","al","en","por","con","para"];n&&(n=n.split(" ").filter(s=>!l.includes(s.toLowerCase())).map(s=>s.charAt(0).toUpperCase()).join(""))}onCancel(){this.router.navigate(["/mantenedores/locales"])}static#e=this.\u0275fac=function(a){return new(a||t)(e.rXU(r.ok),e.rXU(E.R),e.rXU(F.Ix),e.rXU(F.nX),e.rXU(j.T),e.rXU(T),e.rXU(e.gRc))};static#o=this.\u0275cmp=e.VBU({type:t,selectors:[["app-editar-local"]],standalone:!0,features:[e.aNF],decls:143,vars:4,consts:[[1,"cardWithShadow"],[1,"p-24"],[1,"b-t-1"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-sm-6"],[1,"col-sm-4","d-flex","align-items-center"],[1,"mat-subtitle-2","f-w-600","d-block","m-b-16"],[1,"col-sm-8"],["appearance","outline",1,"w-100"],["matInput","","placeholder","Ingrese el nombre del cliente","formControlName","client"],["matInput","","placeholder","Ingrese el nombre del local","formControlName","nombre_local"],["matInput","","placeholder","Ingrese el grupo","formControlName","grupo"],["matInput","","placeholder","Ingrese la referencia","formControlName","referencia"],["matInput","","placeholder","Ingrese el tel\xe9fono","formControlName","telefono"],["matInput","","placeholder","Ingrese el email del local","type","email","formControlName","email_local"],["matInput","","type","number","placeholder","Ingrese el sobreprecio","formControlName","sobreprecio"],["matSuffix",""],["matInput","","type","number","placeholder","Ingrese el valor por local","formControlName","valorPorLocal"],["matPrefix",""],["placeholder","Seleccione una regi\xf3n","formControlName","region",3,"selectionChange"],["disabled",""],[3,"value"],["placeholder","Seleccione una provincia","formControlName","provincia",3,"selectionChange","disabled"],["placeholder","Seleccione una comuna","formControlName","comuna",3,"disabled"],["matInput","","placeholder","Ingrese la direcci\xf3n","formControlName","direccion"],["matInput","","placeholder","Ingrese la zona","formControlName","zona"],["matInput","","placeholder","Ingrese el email del encargado","type","email","formControlName","email_encargado"],["matInput","","placeholder","Ingrese el nombre del encargado","formControlName","nombre_encargado"],["matInput","","placeholder","Ingrese la latitud","formControlName","latitud"],["matInput","","placeholder","Ingrese la longitud","formControlName","longitud"],[1,"row","justify-content-end"],["mat-flat-button","","color","primary","type","submit"],["mat-flat-button","","type","button",3,"click"]],template:function(a,n){1&a&&(e.j41(0,"mat-card",0)(1,"mat-card-content",1)(2,"mat-card-content",2)(3,"form",3),e.bIt("ngSubmit",function(){return n.onSubmit()}),e.j41(4,"div",4)(5,"div",5)(6,"div",4)(7,"div",6)(8,"mat-label",7),e.EFF(9,"Cliente"),e.k0s()(),e.j41(10,"div",8)(11,"mat-form-field",9),e.nrm(12,"input",10),e.k0s()()(),e.j41(13,"div",4)(14,"div",6)(15,"mat-label",7),e.EFF(16,"Nombre Local"),e.k0s()(),e.j41(17,"div",8)(18,"mat-form-field",9),e.nrm(19,"input",11),e.k0s()()(),e.j41(20,"div",4)(21,"div",6)(22,"mat-label",7),e.EFF(23,"Grupo"),e.k0s()(),e.j41(24,"div",8)(25,"mat-form-field",9),e.nrm(26,"input",12),e.k0s()()(),e.j41(27,"div",4)(28,"div",6)(29,"mat-label",7),e.EFF(30,"Referencia"),e.k0s()(),e.j41(31,"div",8)(32,"mat-form-field",9),e.nrm(33,"input",13),e.k0s()()(),e.j41(34,"div",4)(35,"div",6)(36,"mat-label",7),e.EFF(37,"Tel\xe9fono"),e.k0s()(),e.j41(38,"div",8)(39,"mat-form-field",9),e.nrm(40,"input",14),e.k0s()()(),e.j41(41,"div",4)(42,"div",6)(43,"mat-label",7),e.EFF(44,"Email Local"),e.k0s()(),e.j41(45,"div",8)(46,"mat-form-field",9),e.nrm(47,"input",15),e.k0s()()(),e.j41(48,"div",4)(49,"div",6)(50,"mat-label",7),e.EFF(51,"Sobreprecio"),e.k0s()(),e.j41(52,"div",8)(53,"mat-form-field",9),e.nrm(54,"input",16),e.j41(55,"span",17),e.EFF(56,"%"),e.k0s()()()(),e.j41(57,"div",4)(58,"div",6)(59,"mat-label",7),e.EFF(60,"Valor por Local"),e.k0s()(),e.j41(61,"div",8)(62,"mat-form-field",9),e.nrm(63,"input",18),e.j41(64,"span",19),e.EFF(65,"$"),e.k0s()()()()(),e.j41(66,"div",5)(67,"div",4)(68,"div",6)(69,"mat-label",7),e.EFF(70,"Regi\xf3n"),e.k0s()(),e.j41(71,"div",8)(72,"mat-form-field",9)(73,"mat-select",20),e.bIt("selectionChange",function(c){return n.onRegionChange(c)}),e.DNE(74,Ne,2,0,"mat-option",21),e.Z7z(75,Te,2,2,"mat-option",22,Le),e.k0s()()()(),e.j41(77,"div",4)(78,"div",6)(79,"mat-label",7),e.EFF(80,"Provincia"),e.k0s()(),e.j41(81,"div",8)(82,"mat-form-field",9)(83,"mat-select",23),e.bIt("selectionChange",function(c){return n.onProvinciaChange(c)}),e.Z7z(84,$e,2,2,"mat-option",22,Ie),e.k0s()()()(),e.j41(86,"div",4)(87,"div",6)(88,"mat-label",7),e.EFF(89,"Comuna"),e.k0s()(),e.j41(90,"div",8)(91,"mat-form-field",9)(92,"mat-select",24),e.Z7z(93,Re,2,2,"mat-option",22,Se),e.k0s()()()(),e.j41(95,"div",4)(96,"div",6)(97,"mat-label",7),e.EFF(98,"Direcci\xf3n"),e.k0s()(),e.j41(99,"div",8)(100,"mat-form-field",9),e.nrm(101,"input",25),e.k0s()()(),e.j41(102,"div",4)(103,"div",6)(104,"mat-label",7),e.EFF(105,"Zona"),e.k0s()(),e.j41(106,"div",8)(107,"mat-form-field",9),e.nrm(108,"input",26),e.k0s()()(),e.j41(109,"div",4)(110,"div",6)(111,"mat-label",7),e.EFF(112,"Email Encargado"),e.k0s()(),e.j41(113,"div",8)(114,"mat-form-field",9),e.nrm(115,"input",27),e.k0s()()(),e.j41(116,"div",4)(117,"div",6)(118,"mat-label",7),e.EFF(119,"Nombre Encargado"),e.k0s()(),e.j41(120,"div",8)(121,"mat-form-field",9),e.nrm(122,"input",28),e.k0s()()(),e.j41(123,"div",4)(124,"div",6)(125,"mat-label",7),e.EFF(126,"Latitud"),e.k0s()(),e.j41(127,"div",8)(128,"mat-form-field",9),e.nrm(129,"input",29),e.k0s()()(),e.j41(130,"div",4)(131,"div",6)(132,"mat-label",7),e.EFF(133,"Longitud"),e.k0s()(),e.j41(134,"div",8)(135,"mat-form-field",9),e.nrm(136,"input",30),e.k0s()()()()(),e.j41(137,"div",31)(138,"div",8)(139,"button",32),e.EFF(140,"Actualizar Local"),e.k0s(),e.j41(141,"button",33),e.bIt("click",function(){return n.onCancel()}),e.EFF(142,"Volver"),e.k0s()()()()()()()),2&a&&(e.R7$(3),e.Y8G("formGroup",n.localForm),e.R7$(71),e.vxM(n.regiones.length?-1:74),e.R7$(),e.Dyx(n.regiones),e.R7$(8),e.Y8G("disabled",!n.provincias.length),e.R7$(),e.Dyx(n.provincias),e.R7$(8),e.Y8G("disabled",!n.comunas.length),e.R7$(),e.Dyx(n.comunas))},dependencies:[C.MD,r.X1,r.qT,r.me,r.Q0,r.BC,r.cb,r.j4,r.JD,d.RG,d.rl,d.nJ,d.JW,d.yw,h.fS,h.fg,g.Hl,g.$z,p.Hu,p.RN,p.m2,v.Ve,v.VO,L.wT,_.m_]})}return t})(),data:{title:"Editar Local"}}]}}]);