"use strict";(self.webpackChunkSpike=self.webpackChunkSpike||[]).push([[5698],{5698:(Ht,x,m)=>{m.r(x),m.d(x,{TECHNICOS_MOVILES_ROUTES:()=>Nt});var D=m(467),f=m(177),h=m(5596),r=m(9159),_=m(8834),C=m(9213),j=m(4823),g=m(3719),b=m(9631),T=m(2765),k=m(5024),w=m(8032),u=m.n(w),M=m(8887),t=m(3953),V=m(9386),S=m(5602),O=m(446),$=m(1626);let E=(()=>{class e{constructor(o){this.http=o,this.apiUrl=`${O.c.apiUrl}user-vehiculo`}getUserVehiculos(){return this.http.get(this.apiUrl)}getUserVehiculo(o){return this.http.get(`${this.apiUrl}/${o}`)}createUserVehiculo(o){return this.http.post(this.apiUrl,o)}updateUserVehiculo(o,i){return this.http.put(`${this.apiUrl}/${o}`,i)}deleteUserVehiculo(o){return this.http.delete(`${this.apiUrl}/${o}`)}updateOdometroFin(o,i){return this.http.put(`${this.apiUrl}/${o}/odometro-fin`,{odometroFin:i})}getLastAssignment(o){return this.http.get(`${this.apiUrl}/last-assignment/${o}`)}getHistorial(){return this.http.get(`${this.apiUrl}/historial`)}static#t=this.\u0275fac=function(i){return new(i||e)(t.KVO($.Qq))};static#e=this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const y=()=>["historial"];function P(e,n){1&e&&t.nrm(0,"th",35)}function R(e,n){if(1&e){const o=t.RV6();t.j41(0,"td",36)(1,"mat-checkbox",37),t.bIt("click",function(a){return t.eBV(o),t.Njj(a.stopPropagation())})("change",function(){const a=t.eBV(o).$implicit,c=t.XpG();return t.Njj(c.toggleTecnicoSelection(a))}),t.k0s()()}if(2&e){const o=n.$implicit,i=t.XpG();t.R7$(),t.Y8G("checked",i.selectionTecnicos.isSelected(o))}}function N(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Nombre"),t.k0s())}function I(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.Lme(" ",o.name," ",o.lastName," ")}}function H(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Especialidades"),t.k0s())}function G(e,n){if(1&e&&(t.j41(0,"span",41),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",o.nombre," ")}}function U(e,n){1&e&&(t.j41(0,"span",42),t.EFF(1," Sin especialidades "),t.k0s())}function A(e,n){if(1&e&&(t.j41(0,"td",36)(1,"div",38),t.DNE(2,G,2,1,"span",39)(3,U,2,0,"span",40),t.k0s()()),2&e){const o=n.$implicit;t.R7$(2),t.Y8G("ngForOf",o.especialidades),t.R7$(),t.Y8G("ngIf",!(null!=o.especialidades&&o.especialidades.length))}}function z(e,n){if(1&e&&t.nrm(0,"tr",43),2&e){const o=t.XpG();t.Y8G("hidden",0===o.dataSourceTecnicos.data.length)}}function Y(e,n){1&e&&t.nrm(0,"tr",44)}function B(e,n){if(1&e&&(t.j41(0,"tr",45)(1,"td",46)(2,"div",47)(3,"mat-icon",48),t.EFF(4,"engineering"),t.k0s(),t.j41(5,"h4",49),t.EFF(6,"No hay t\xe9cnicos disponibles"),t.k0s(),t.j41(7,"p",42),t.EFF(8),t.k0s()()()()),2&e){const o=t.XpG(),i=t.sdS(11);t.R7$(),t.BMQ("colspan",o.displayedColumnsTecnicos.length),t.R7$(7),t.JRh(i.value?"No se encontraron t\xe9cnicos que coincidan con la b\xfasqueda":"Todos los t\xe9cnicos est\xe1n asignados el d\xeda de hoy")}}function L(e,n){1&e&&t.nrm(0,"th",35)}function X(e,n){if(1&e){const o=t.RV6();t.j41(0,"td",36)(1,"mat-checkbox",37),t.bIt("click",function(a){return t.eBV(o),t.Njj(a.stopPropagation())})("change",function(a){const c=t.eBV(o).$implicit,s=t.XpG();return t.Njj(a?s.toggleVehiculoSelection(c):null)}),t.k0s()()}if(2&e){const o=n.$implicit,i=t.XpG();t.R7$(),t.Y8G("checked",i.selectionVehiculos.isSelected(o))}}function J(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Patente"),t.k0s())}function Q(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.JRh(o.patente)}}function W(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Marca"),t.k0s())}function Z(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.JRh(o.marca)}}function q(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Modelo"),t.k0s())}function K(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.JRh(o.modelo)}}function tt(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"\xdaltimo Od\xf3metro"),t.k0s())}function et(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",o.ultimo_odometro?t.i5U(2,1,o.ultimo_odometro,"1.0-0")+" km":"Sin registros"," ")}}function ot(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Estado"),t.k0s())}function nt(e,n){if(1&e&&(t.j41(0,"td",36)(1,"span"),t.EFF(2),t.k0s()()),2&e){const o=n.$implicit;t.R7$(),t.AVh("text-success",!o.asignado)("text-warning",o.asignado),t.R7$(),t.SpI(" ",o.asignado?"En uso":"Disponible"," ")}}function it(e,n){if(1&e&&t.nrm(0,"tr",43),2&e){const o=t.XpG();t.Y8G("hidden",0===o.dataSourceVehiculos.data.length)}}function at(e,n){1&e&&t.nrm(0,"tr",44)}function ct(e,n){if(1&e&&(t.j41(0,"tr",45)(1,"td",46)(2,"div",47)(3,"mat-icon",48),t.EFF(4,"directions_car_off"),t.k0s(),t.j41(5,"h4",49),t.EFF(6,"No hay veh\xedculos disponibles"),t.k0s(),t.j41(7,"p",42),t.EFF(8),t.k0s()()()()),2&e){const o=t.XpG(),i=t.sdS(37);t.R7$(),t.BMQ("colspan",o.displayedColumnsVehiculos.length),t.R7$(7),t.JRh(i.value?"No se encontraron veh\xedculos que coincidan con la patente":"Todos los veh\xedculos est\xe1n asignados el d\xeda de hoy")}}function st(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"T\xe9cnico"),t.k0s())}function rt(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.Lme(" ",o.user.name," ",o.user.lastName," ")}}function lt(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Veh\xedculo"),t.k0s())}function mt(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",o.vehiculo.patente," ")}}function dt(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Fecha Asignaci\xf3n"),t.k0s())}function ut(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,o.fecha_utilizado,"dd/MM/yyyy HH:mm")," ")}}function ht(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Od\xf3metro Inicial"),t.k0s())}function pt(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",o.odometro_inicio," km ")}}function ft(e,n){1&e&&(t.j41(0,"th",35),t.EFF(1,"Od\xf3metro Final"),t.k0s())}function gt(e,n){if(1&e&&(t.j41(0,"td",36),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",o.odometro_fin?o.odometro_fin+" km":"En uso"," ")}}function _t(e,n){if(1&e&&t.nrm(0,"tr",43),2&e){const o=t.XpG();t.Y8G("hidden",!o.asignaciones.length)}}function Ct(e,n){1&e&&t.nrm(0,"tr",44)}function bt(e,n){if(1&e&&(t.j41(0,"tr",45)(1,"td",46)(2,"div",47)(3,"mat-icon",48),t.EFF(4,"assignment"),t.k0s(),t.j41(5,"h4",49),t.EFF(6,"No hay asignaciones"),t.k0s(),t.j41(7,"p",42),t.EFF(8,"No se encontraron asignaciones para este d\xeda"),t.k0s()()()()),2&e){const o=t.XpG();t.R7$(),t.BMQ("colspan",o.displayedColumnsAsignaciones.length)}}let Ft=(()=>{class e{constructor(o,i,a){this.vehiculosService=o,this.usersService=i,this.userVehiculoService=a,this.tecnicos=[],this.vehiculos=[],this.asignaciones=[],this.fechaHoy=new Date,this.displayedColumnsTecnicos=["select","nombre","especialidades"],this.displayedColumnsVehiculos=["select","patente","marca","modelo","ultimo_odometro","acciones"],this.displayedColumnsAsignaciones=["tecnico","vehiculo","fecha","odometro_inicio","odometro_fin"],this.selectionTecnicos=new k.CB(!1,[]),this.selectionVehiculos=new k.CB(!1,[]),this.dataSourceTecnicos=new r.I6,this.dataSourceVehiculos=new r.I6,this.dataSourceTecnicos.filterPredicate=(c,s)=>`${c.name} ${c.lastName}`.toLowerCase().includes(s),this.dataSourceVehiculos.filterPredicate=(c,s)=>c.patente.toLowerCase().includes(s)}ngOnInit(){this.loadData()}loadData(){this.loadAsignaciones()}esMismaFecha(o,i){return o.getFullYear()===i.getFullYear()&&o.getMonth()===i.getMonth()&&o.getDate()===i.getDate()}loadAsignaciones(){this.userVehiculoService.getUserVehiculos().subscribe({next:o=>{this.asignaciones=o.filter(i=>this.esMismaFecha(new Date(i.fecha_utilizado),this.fechaHoy)),this.loadTecnicos(),this.loadVehiculos()},error:o=>{console.error("Error al cargar asignaciones:",o)}})}finalizarAsignacion(o){u().fire({title:"Ingrese el od\xf3metro final",input:"number",inputLabel:"Od\xf3metro (km)",inputPlaceholder:"Ingrese el kilometraje actual",showCancelButton:!0,confirmButtonText:"Finalizar",cancelButtonText:"Cancelar",inputValidator:i=>!i||i<0?"Debe ingresar un valor v\xe1lido para el od\xf3metro":Number(i)<=o.odometro_inicio?"El od\xf3metro final debe ser mayor al inicial":null}).then(i=>{i.isConfirmed&&this.userVehiculoService.updateUserVehiculo(o.id,{...o,odometro_fin:Number(i.value)}).subscribe({next:()=>{u().fire("\xc9xito","Asignaci\xf3n finalizada correctamente","success"),this.loadData()},error:a=>{console.error("Error al finalizar asignaci\xf3n:",a),u().fire("Error","No se pudo finalizar la asignaci\xf3n","error")}})})}toggleTecnicoSelection(o){this.selectionTecnicos.isSelected(o)?this.selectionTecnicos.clear():(this.selectionTecnicos.clear(),this.selectionTecnicos.select(o))}toggleVehiculoSelection(o){this.selectionVehiculos.isSelected(o)?this.selectionVehiculos.clear():(this.selectionVehiculos.clear(),this.selectionVehiculos.select(o))}isAllSelectedVehiculos(){return this.selectionVehiculos.selected.length===this.vehiculos.length}masterToggleVehiculos(){this.isAllSelectedVehiculos()?this.selectionVehiculos.clear():this.vehiculos.forEach(o=>this.selectionVehiculos.select(o))}loadTecnicos(){this.usersService.getAllTecnicos().subscribe(o=>{this.tecnicos=o.filter(i=>!this.asignaciones.find(c=>c.user.id===i.id&&!c.odometro_fin&&this.esMismaFecha(new Date(c.fecha_utilizado),this.fechaHoy))),this.dataSourceTecnicos.data=this.tecnicos})}loadVehiculos(){var o=this;this.vehiculosService.getVehiculos().subscribe(i=>{const a=i.map(function(){var c=(0,D.A)(function*(s){try{const l=yield o.userVehiculoService.getLastAssignment(s.id).toPromise();return{...s,ultimo_odometro:l?l.odometro_inicio:0}}catch(l){return console.error("Error al obtener \xfaltima asignaci\xf3n:",l),{...s,ultimo_odometro:0}}});return function(s){return c.apply(this,arguments)}}());Promise.all(a).then(c=>{this.vehiculos=c.filter(s=>!this.asignaciones.find(d=>d.vehiculo.id===s.id&&!d.odometro_fin&&this.esMismaFecha(new Date(d.fecha_utilizado),this.fechaHoy))),this.dataSourceVehiculos.data=this.vehiculos})})}asignarVehiculo(o){const i=this.selectionTecnicos.selected[0],a=this.selectionVehiculos.selected[0];i&&a?this.userVehiculoService.getLastAssignment(a.id).subscribe({next:c=>{const s=c?c.odometro_inicio:0;u().fire({title:"Ingrese el od\xf3metro inicial",input:"number",inputLabel:"Od\xf3metro (km)",html:s?`<div class="mb-3">\xdaltimo od\xf3metro registrado: <strong>${s.toLocaleString()} km</strong></div>`:"",inputPlaceholder:"Ingrese el kilometraje actual",showCancelButton:!0,confirmButtonText:"Asignar",cancelButtonText:"Cancelar",inputValidator:l=>!l||l<0?"Debe ingresar un valor v\xe1lido para el od\xf3metro":c&&Number(l)<s?`El od\xf3metro inicial no puede ser menor al \xfaltimo registrado (${s.toLocaleString()} km)`:null}).then(l=>{l.isConfirmed&&this.userVehiculoService.createUserVehiculo({userId:i.id,vehiculoId:a.id,fecha_utilizado:new Date,odometro_inicio:Number(l.value),odometro_fin:void 0}).subscribe({next:d=>{u().fire({title:"Asignaci\xf3n creada",text:"El veh\xedculo ha sido asignado al t\xe9cnico. Si exist\xeda una asignaci\xf3n anterior sin finalizar, se ha actualizado su od\xf3metro final.",icon:"success"}),this.loadData()},error:d=>{console.error("Error al asignar:",d);let v="No se pudo realizar la asignaci\xf3n";d.error&&d.error.message&&(v=`${d.error.message} (${d.error.lastOdometro.toLocaleString()} km)`),u().fire("Error",v,"error")}})})},error:c=>{console.error("Error al obtener \xfaltima asignaci\xf3n:",c),u().fire("Error","No se pudo obtener la informaci\xf3n del veh\xedculo","error")}}):u().fire("Error","Debe seleccionar un t\xe9cnico y un veh\xedculo","warning")}verAsignaciones(o){console.log("Ver asignaciones de:",o)}asignarSeleccionados(){const o=this.selectionTecnicos.selected,i=this.selectionVehiculos.selected;o.length&&i.length&&u().fire({title:"Ingrese el od\xf3metro inicial",input:"number",inputLabel:"Od\xf3metro (km)",inputPlaceholder:"Ingrese el kilometraje actual",showCancelButton:!0,confirmButtonText:"Asignar",cancelButtonText:"Cancelar",inputValidator:a=>!a||a<0?"Debe ingresar un valor v\xe1lido para el od\xf3metro":null}).then(a=>{if(a.isConfirmed){const s=o.map(l=>i.map(d=>({userId:l.id,vehiculoId:d.id,fecha_utilizado:new Date,odometro_inicio:Number(a.value),odometro_fin:void 0}))).flat().map(l=>this.userVehiculoService.createUserVehiculo(l).toPromise());Promise.all(s).then(()=>{u().fire({title:"\xc9xito",text:"Asignaciones realizadas correctamente. Si exist\xedan asignaciones anteriores sin finalizar, se han actualizado sus od\xf3metros finales.",icon:"success"}),this.selectionTecnicos.clear(),this.selectionVehiculos.clear(),this.loadData()}).catch(l=>{console.error("Error al asignar:",l),u().fire("Error",l.error.message||"No se pudieron realizar las asignaciones","error")})}})}applyFilterTecnicos(o){this.dataSourceTecnicos.filter=o.target.value.trim().toLowerCase()}applyFilterVehiculos(o){this.dataSourceVehiculos.filter=o.target.value.trim().toLowerCase()}static#t=this.\u0275fac=function(i){return new(i||e)(t.rXU(V.c),t.rXU(S.g),t.rXU(E))};static#e=this.\u0275cmp=t.VBU({type:e,selectors:[["app-tecnicos-moviles"]],standalone:!0,features:[t.aNF],decls:98,vars:18,consts:[["inputTecnicos",""],["inputVehiculos",""],[1,"lists-container"],[1,"lists-grid"],[1,"cardWithShadow"],[1,"p-24"],[1,"w-100","mb-3"],["matInput","","placeholder","Nombre del t\xe9cnico",3,"keyup"],["matSuffix",""],[1,"table-container"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["matColumnDef","especialidades"],["mat-header-row","",3,"hidden",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["matInput","","placeholder","Patente del veh\xedculo",3,"keyup"],["matColumnDef","patente"],["matColumnDef","marca"],["matColumnDef","modelo"],["matColumnDef","ultimo_odometro"],["matColumnDef","acciones"],[1,"action-buttons","mt-4","text-center"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"d-flex","justify-content-between","align-items-center"],["mat-raised-button","","color","primary",3,"routerLink"],["matColumnDef","tecnico"],["matColumnDef","vehiculo"],["matColumnDef","fecha"],["matColumnDef","odometro_inicio"],["matColumnDef","odometro_fin"],["mat-header-row","",3,"hidden",4,"matHeaderRowDef"],["mat-header-cell",""],["mat-cell",""],[3,"click","change","checked"],[1,"d-flex","gap-1","flex-wrap"],["class","badge rounded-pill bg-light text-dark border",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark","border"],[1,"text-muted"],["mat-header-row","",3,"hidden"],["mat-row",""],[1,"mat-row"],[1,"mat-cell","text-center"],[1,"d-flex","flex-column","align-items-center","p-4"],[1,"mb-3",2,"transform","scale(2)","opacity","0.7"],[1,"mb-2"]],template:function(i,a){if(1&i){const c=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"mat-card",4)(3,"mat-card-header")(4,"mat-card-title"),t.EFF(5,"T\xe9cnicos Disponibles"),t.k0s()(),t.j41(6,"mat-card-content",5)(7,"mat-form-field",6)(8,"mat-label"),t.EFF(9,"Buscar por nombre"),t.k0s(),t.j41(10,"input",7,0),t.bIt("keyup",function(l){return t.eBV(c),t.Njj(a.applyFilterTecnicos(l))}),t.k0s(),t.j41(12,"mat-icon",8),t.EFF(13,"search"),t.k0s()(),t.j41(14,"div",9)(15,"table",10),t.qex(16,11),t.DNE(17,P,1,0,"th",12)(18,R,2,1,"td",13),t.bVm(),t.qex(19,14),t.DNE(20,N,2,0,"th",12)(21,I,2,2,"td",13),t.bVm(),t.qex(22,15),t.DNE(23,H,2,0,"th",12)(24,A,4,2,"td",13),t.bVm(),t.DNE(25,z,1,1,"tr",16)(26,Y,1,0,"tr",17)(27,B,9,2,"tr",18),t.k0s()()()(),t.j41(28,"mat-card",4)(29,"mat-card-header")(30,"mat-card-title"),t.EFF(31,"Veh\xedculos Disponibles"),t.k0s()(),t.j41(32,"mat-card-content",5)(33,"mat-form-field",6)(34,"mat-label"),t.EFF(35,"Buscar por patente"),t.k0s(),t.j41(36,"input",19,1),t.bIt("keyup",function(l){return t.eBV(c),t.Njj(a.applyFilterVehiculos(l))}),t.k0s(),t.j41(38,"mat-icon",8),t.EFF(39,"search"),t.k0s()(),t.j41(40,"div",9)(41,"table",10),t.qex(42,11),t.DNE(43,L,1,0,"th",12)(44,X,2,1,"td",13),t.bVm(),t.qex(45,20),t.DNE(46,J,2,0,"th",12)(47,Q,2,1,"td",13),t.bVm(),t.qex(48,21),t.DNE(49,W,2,0,"th",12)(50,Z,2,1,"td",13),t.bVm(),t.qex(51,22),t.DNE(52,q,2,0,"th",12)(53,K,2,1,"td",13),t.bVm(),t.qex(54,23),t.DNE(55,tt,2,0,"th",12)(56,et,3,4,"td",13),t.bVm(),t.qex(57,24),t.DNE(58,ot,2,0,"th",12)(59,nt,3,5,"td",13),t.bVm(),t.DNE(60,it,1,1,"tr",16)(61,at,1,0,"tr",17)(62,ct,9,2,"tr",18),t.k0s()()()()(),t.j41(63,"div",25)(64,"button",26),t.bIt("click",function(){return t.eBV(c),t.Njj(a.asignarSeleccionados())}),t.j41(65,"mat-icon"),t.EFF(66,"link"),t.k0s(),t.EFF(67," Asignar Veh\xedculos a T\xe9cnicos "),t.k0s()(),t.j41(68,"mat-card",4)(69,"mat-card-header",27)(70,"mat-card-title"),t.EFF(71),t.nI1(72,"date"),t.k0s(),t.j41(73,"button",28)(74,"mat-icon"),t.EFF(75,"history"),t.k0s(),t.EFF(76," Ver Historial "),t.k0s()(),t.j41(77,"mat-card-content",5)(78,"div",9)(79,"table",10),t.qex(80,29),t.DNE(81,st,2,0,"th",12)(82,rt,2,2,"td",13),t.bVm(),t.qex(83,30),t.DNE(84,lt,2,0,"th",12)(85,mt,2,1,"td",13),t.bVm(),t.qex(86,31),t.DNE(87,dt,2,0,"th",12)(88,ut,3,4,"td",13),t.bVm(),t.qex(89,32),t.DNE(90,ht,2,0,"th",12)(91,pt,2,1,"td",13),t.bVm(),t.qex(92,33),t.DNE(93,ft,2,0,"th",12)(94,gt,2,1,"td",13),t.bVm(),t.DNE(95,_t,1,1,"tr",34)(96,Ct,1,0,"tr",17)(97,bt,9,1,"tr",18),t.k0s()()()()()}2&i&&(t.R7$(15),t.Y8G("dataSource",a.dataSourceTecnicos),t.R7$(10),t.Y8G("matHeaderRowDef",a.displayedColumnsTecnicos)("matHeaderRowDefSticky",!0),t.R7$(),t.Y8G("matRowDefColumns",a.displayedColumnsTecnicos),t.R7$(15),t.Y8G("dataSource",a.dataSourceVehiculos),t.R7$(19),t.Y8G("matHeaderRowDef",a.displayedColumnsVehiculos)("matHeaderRowDefSticky",!0),t.R7$(),t.Y8G("matRowDefColumns",a.displayedColumnsVehiculos),t.R7$(3),t.Y8G("disabled",!a.selectionTecnicos.hasValue()||!a.selectionVehiculos.hasValue()),t.R7$(7),t.SpI("Asignaciones del d\xeda ",t.i5U(72,14,a.fechaHoy,"dd/MM/yyyy"),""),t.R7$(2),t.Y8G("routerLink",t.lJ4(17,y)),t.R7$(6),t.Y8G("dataSource",a.asignaciones),t.R7$(16),t.Y8G("matHeaderRowDef",a.displayedColumnsAsignaciones),t.R7$(),t.Y8G("matRowDefColumns",a.displayedColumnsAsignaciones))},dependencies:[f.MD,f.Sq,f.bT,f.QX,f.vh,h.Hu,h.RN,h.m2,h.MM,h.dh,r.tP,r.Zl,r.tL,r.ji,r.cC,r.YV,r.iL,r.KS,r.$R,r.YZ,r.NB,r.ky,_.Hl,_.$z,C.m_,C.An,j.uc,g.RG,g.rl,g.nJ,g.yw,b.fS,b.fg,T.g7,T.So,M.iI,M.Wk],styles:[".assignment-container[_ngcontent-%COMP%]{padding:24px}.assignment-container[_ngcontent-%COMP%]   .cardWithShadow[_ngcontent-%COMP%]{margin-bottom:24px}.assignment-container[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:16px 24px;margin-bottom:0;border-bottom:1px solid rgba(0,0,0,.12)}.assignment-container[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{margin:0;font-size:20px;font-weight:500}.assignment-container[_ngcontent-%COMP%]   .assignments-list[_ngcontent-%COMP%]   .assignment-item[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid rgba(0,0,0,.12);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px}.assignment-container[_ngcontent-%COMP%]   .assignments-list[_ngcontent-%COMP%]   .assignment-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.assignment-container[_ngcontent-%COMP%]   .assignments-list[_ngcontent-%COMP%]   .assignment-item[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]{flex:1;min-width:200px}.assignment-container[_ngcontent-%COMP%]   .assignments-list[_ngcontent-%COMP%]   .assignment-item[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#000000de;margin-right:8px}.assignment-container[_ngcontent-%COMP%]   .assignments-list[_ngcontent-%COMP%]   .no-assignments[_ngcontent-%COMP%]{padding:24px;text-align:center;color:#0000008a;font-style:italic}@media (max-width: 768px){.assignment-item[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start!important}.assignment-item[_ngcontent-%COMP%]   .assignment-info[_ngcontent-%COMP%]{width:100%}}.lists-container[_ngcontent-%COMP%]{padding:20px}.lists-container[_ngcontent-%COMP%]   .lists-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:20px}  .mat-mdc-table{background:transparent!important;border:1px solid rgba(0,0,0,.12);border-radius:4px;overflow:hidden}  .mat-mdc-table .mat-mdc-header-row{background-color:#fafafa}  .mat-mdc-table .mat-mdc-header-cell{color:#000000de;font-weight:500;font-size:14px}  .mat-mdc-table .mat-mdc-cell{color:#000000de;font-size:14px}  .mat-mdc-table .mat-mdc-row:not(:last-child){border-bottom:1px solid rgba(0,0,0,.12)}  .mat-mdc-card{border-radius:8px}  .mat-mdc-card .mat-mdc-card-header{padding:16px 24px;border-bottom:1px solid rgba(0,0,0,.12)}  .mat-mdc-card .mat-mdc-card-header .mat-mdc-card-title{margin:0;font-size:18px;font-weight:500}  .mat-mdc-no-data-row{height:auto}  .mat-mdc-no-data-row .mat-mdc-cell{padding:64px 0;border-bottom:none!important}  .mat-mdc-no-data-row .mat-mdc-cell .d-flex{gap:16px}  .mat-mdc-no-data-row .mat-icon{color:#00000061;font-size:48px;height:48px;width:48px;margin-bottom:24px!important}  .mat-mdc-no-data-row h4{color:#000000de;font-weight:500;margin:0;font-size:20px;margin-bottom:16px!important}  .mat-mdc-no-data-row p{color:#0009;margin:0;font-size:16px}.table-container[_ngcontent-%COMP%]{height:300px;overflow:auto;border:1px solid rgba(0,0,0,.12);border-radius:4px;position:relative}.table-container[_ngcontent-%COMP%]   .mat-mdc-table[_ngcontent-%COMP%]{border:none;min-height:100%}.table-container[_ngcontent-%COMP%]   .mat-mdc-no-data-row[_ngcontent-%COMP%]{position:absolute;inset:0;background:#fff;display:flex;align-items:center;justify-content:center}.table-container[_ngcontent-%COMP%]   .mat-mdc-no-data-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{border:none;display:flex;align-items:center;justify-content:center;height:100%;width:100%}.table-container[_ngcontent-%COMP%]   .mat-mdc-no-data-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{flex-direction:column;align-items:center;justify-content:center;text-align:center;max-width:300px;margin:0 auto}.table-container[_ngcontent-%COMP%]   .mat-mdc-no-data-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:16px;opacity:.7}.table-container[_ngcontent-%COMP%]   .mat-mdc-no-data-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:20px;margin-bottom:8px;font-weight:500}.table-container[_ngcontent-%COMP%]   .mat-mdc-no-data-row[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#0009;margin:0}.mat-mdc-form-field[_ngcontent-%COMP%]{background-color:#fff;border-radius:4px}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{padding-left:8px;padding-right:8px}.table-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}.table-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}.table-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888;border-radius:4px}.table-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#666}.mat-mdc-header-row[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1;background-color:#fafafa}.badge[_ngcontent-%COMP%]{padding:4px 8px;font-size:12px;font-weight:400;margin:2px;white-space:nowrap}.badge.bg-light[_ngcontent-%COMP%]{background-color:#f8f9fa!important;border-color:#dee2e6!important}.gap-1[_ngcontent-%COMP%]{gap:.25rem!important}.flex-wrap[_ngcontent-%COMP%]{flex-wrap:wrap!important}"]})}return e})();var F=m(5084),vt=m(6600),p=m(9417);function xt(e,n){1&e&&(t.j41(0,"th",29),t.EFF(1,"T\xe9cnico"),t.k0s())}function Tt(e,n){if(1&e&&(t.j41(0,"td",30),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.Lme(" ",o.user.name," ",o.user.lastName," ")}}function kt(e,n){1&e&&(t.j41(0,"th",29),t.EFF(1,"Veh\xedculo"),t.k0s())}function Mt(e,n){if(1&e&&(t.j41(0,"td",30),t.EFF(1),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",o.vehiculo.patente," ")}}function Et(e,n){1&e&&(t.j41(0,"th",29),t.EFF(1,"Fecha Asignaci\xf3n"),t.k0s())}function Dt(e,n){if(1&e&&(t.j41(0,"td",30),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,o.fecha_utilizado,"dd/MM/yyyy HH:mm")," ")}}function jt(e,n){1&e&&(t.j41(0,"th",29),t.EFF(1,"Od\xf3metro Inicial"),t.k0s())}function wt(e,n){if(1&e&&(t.j41(0,"td",30),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,o.odometro_inicio,"1.0-0")," km ")}}function Vt(e,n){1&e&&(t.j41(0,"th",29),t.EFF(1,"Od\xf3metro Final"),t.k0s())}function St(e,n){if(1&e&&(t.j41(0,"td",30),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",o.odometro_fin?t.i5U(2,1,o.odometro_fin,"1.0-0")+" km":"En uso"," ")}}function Ot(e,n){1&e&&(t.j41(0,"th",29),t.EFF(1,"Kilometraje"),t.k0s())}function $t(e,n){if(1&e&&(t.j41(0,"td",30),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&e){const o=n.$implicit;t.R7$(),t.SpI(" ",o.kilometraje?t.i5U(2,1,o.kilometraje,"1.0-0")+" km":"-"," ")}}function yt(e,n){1&e&&t.nrm(0,"tr",31)}function Pt(e,n){1&e&&t.nrm(0,"tr",32)}function Rt(e,n){if(1&e&&(t.j41(0,"tr",33)(1,"td",34)(2,"div",35)(3,"mat-icon",36),t.EFF(4,"assignment"),t.k0s(),t.j41(5,"h4",37),t.EFF(6,"No hay registros"),t.k0s(),t.j41(7,"p",38),t.EFF(8,"No se encontraron asignaciones que coincidan con los filtros"),t.k0s()()()()),2&e){const o=t.XpG();t.R7$(),t.BMQ("colspan",o.displayedColumns.length)}}const Nt=[{path:"",component:Ft,data:{title:"Tecnicos Moviles",breadcrumb:"Tecnicos Moviles"}},{path:"historial",component:(()=>{class e{constructor(o,i){this.userVehiculoService=o,this.fb=i,this.displayedColumns=["tecnico","vehiculo","fecha","odometro_inicio","odometro_fin","kilometraje"],this.dataSource=new r.I6([]),this.filtroForm=this.fb.group({fechaInicio:[null],fechaFin:[null],tecnico:[""],vehiculo:[""]})}ngOnInit(){this.cargarHistorial(),this.filtroForm.valueChanges.subscribe(()=>{this.aplicarFiltros()})}cargarHistorial(){this.userVehiculoService.getUserVehiculos().subscribe({next:o=>{o&&Array.isArray(o)&&(this.dataSource.data=o.map(i=>({...i,kilometraje:i.odometro_fin?i.odometro_fin-i.odometro_inicio:null})),this.aplicarFiltros())},error:o=>{console.error("Error al cargar historial:",o),this.dataSource.data=[]}})}aplicarFiltros(){const o=this.filtroForm.value;this.dataSource.filterPredicate=(i,a)=>{const c=!o.tecnico||(i.user.name+" "+i.user.lastName).toLowerCase().includes(o.tecnico.toLowerCase()),s=!o.vehiculo||i.vehiculo.patente.toLowerCase().includes(o.vehiculo.toLowerCase()),l=new Date(i.fecha_utilizado),d=!o.fechaInicio||l>=new Date(o.fechaInicio),v=!o.fechaFin||l<=new Date(o.fechaFin);return c&&s&&d&&v},this.dataSource.filter=JSON.stringify(o)}limpiarFiltros(){this.filtroForm.reset({fechaInicio:null,fechaFin:null,tecnico:"",vehiculo:""})}static#t=this.\u0275fac=function(i){return new(i||e)(t.rXU(E),t.rXU(p.ok))};static#e=this.\u0275cmp=t.VBU({type:e,selectors:[["app-historial"]],standalone:!0,features:[t.aNF],decls:65,vars:9,consts:[["pickerInicio",""],["pickerFin",""],[1,"container-fluid"],[1,"cardWithShadow"],[1,"p-24"],[1,"row","mb-4",3,"formGroup"],[1,"col-md-3"],[1,"w-100"],["matInput","","formControlName","fechaInicio",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","fechaFin",3,"matDatepicker"],["matInput","","formControlName","tecnico","placeholder","Nombre del t\xe9cnico"],["matSuffix",""],["matInput","","formControlName","vehiculo","placeholder","Patente del veh\xedculo"],[1,"col-12","text-end"],["mat-button","","color","warn",3,"click"],[1,"table-container"],["mat-table","",1,"w-100",3,"dataSource"],["matColumnDef","tecnico"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","vehiculo"],["matColumnDef","fecha"],["matColumnDef","odometro_inicio"],["matColumnDef","odometro_fin"],["matColumnDef","kilometraje"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell","text-center"],[1,"d-flex","flex-column","align-items-center","p-4"],[1,"mb-3",2,"transform","scale(2)","opacity","0.7"],[1,"mb-2"],[1,"text-muted"]],template:function(i,a){if(1&i){const c=t.RV6();t.j41(0,"div",2)(1,"mat-card",3)(2,"mat-card-header")(3,"mat-card-title"),t.EFF(4,"Historial de Asignaciones"),t.k0s()(),t.j41(5,"mat-card-content",4)(6,"form",5)(7,"div",6)(8,"mat-form-field",7)(9,"mat-label"),t.EFF(10,"Fecha Inicio"),t.k0s(),t.nrm(11,"input",8)(12,"mat-datepicker-toggle",9)(13,"mat-datepicker",null,0),t.k0s()(),t.j41(15,"div",6)(16,"mat-form-field",7)(17,"mat-label"),t.EFF(18,"Fecha Fin"),t.k0s(),t.nrm(19,"input",10)(20,"mat-datepicker-toggle",9)(21,"mat-datepicker",null,1),t.k0s()(),t.j41(23,"div",6)(24,"mat-form-field",7)(25,"mat-label"),t.EFF(26,"Buscar por t\xe9cnico"),t.k0s(),t.nrm(27,"input",11),t.j41(28,"mat-icon",12),t.EFF(29,"search"),t.k0s()()(),t.j41(30,"div",6)(31,"mat-form-field",7)(32,"mat-label"),t.EFF(33,"Buscar por patente"),t.k0s(),t.nrm(34,"input",13),t.j41(35,"mat-icon",12),t.EFF(36,"search"),t.k0s()()(),t.j41(37,"div",14)(38,"button",15),t.bIt("click",function(){return t.eBV(c),t.Njj(a.limpiarFiltros())}),t.j41(39,"mat-icon"),t.EFF(40,"clear"),t.k0s(),t.EFF(41," Limpiar filtros "),t.k0s()()(),t.j41(42,"div",16)(43,"table",17),t.qex(44,18),t.DNE(45,xt,2,0,"th",19)(46,Tt,2,2,"td",20),t.bVm(),t.qex(47,21),t.DNE(48,kt,2,0,"th",19)(49,Mt,2,1,"td",20),t.bVm(),t.qex(50,22),t.DNE(51,Et,2,0,"th",19)(52,Dt,3,4,"td",20),t.bVm(),t.qex(53,23),t.DNE(54,jt,2,0,"th",19)(55,wt,3,4,"td",20),t.bVm(),t.qex(56,24),t.DNE(57,Vt,2,0,"th",19)(58,St,3,4,"td",20),t.bVm(),t.qex(59,25),t.DNE(60,Ot,2,0,"th",19)(61,$t,3,4,"td",20),t.bVm(),t.DNE(62,yt,1,0,"tr",26)(63,Pt,1,0,"tr",27)(64,Rt,9,1,"tr",28),t.k0s()()()()()}if(2&i){const c=t.sdS(14),s=t.sdS(22);t.R7$(6),t.Y8G("formGroup",a.filtroForm),t.R7$(5),t.Y8G("matDatepicker",c),t.R7$(),t.Y8G("for",c),t.R7$(7),t.Y8G("matDatepicker",s),t.R7$(),t.Y8G("for",s),t.R7$(23),t.Y8G("dataSource",a.dataSource),t.R7$(19),t.Y8G("matHeaderRowDef",a.displayedColumns)("matHeaderRowDefSticky",!0),t.R7$(),t.Y8G("matRowDefColumns",a.displayedColumns)}},dependencies:[f.MD,f.QX,f.vh,h.Hu,h.RN,h.m2,h.MM,h.dh,r.tP,r.Zl,r.tL,r.ji,r.cC,r.YV,r.iL,r.KS,r.$R,r.YZ,r.NB,r.ky,g.RG,g.rl,g.nJ,g.yw,b.fS,b.fg,C.m_,C.An,_.Hl,_.$z,F.X6,F.Vh,F.bZ,F.bU,vt.WX,p.YN,p.qT,p.me,p.BC,p.cb,p.X1,p.j4,p.JD],styles:[".table-container[_ngcontent-%COMP%]{position:relative;max-height:calc(100vh - 300px);overflow:auto}table[_ngcontent-%COMP%]{width:100%}"]})}return e})(),data:{title:"Historial de Asignaciones",urls:[{title:"T\xe9cnicos M\xf3viles",url:"/mantenedores/tecnicos-moviles"},{title:"Historial"}]}}]}}]);