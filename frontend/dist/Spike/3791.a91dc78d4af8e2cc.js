"use strict";(self.webpackChunkSpike=self.webpackChunkSpike||[]).push([[3791],{3791:(H,f,t)=>{t.r(f),t.d(f,{solicitudAprobacionCorrectivaRoutes:()=>y});var u=t(177),r=t(9417),b=t(8834),v=t(5596),h=t(6600),S=t(5084),d=t(3719),E=t(9213),g=t(9631),F=t(2798),C=t(8032),p=t.n(C),o=t(3953),j=t(4683),A=t(8949),$=t(5602),k=t(390),I=t(2697),N=t(8887),R=t(6431);function G(e,c){if(1&e&&(o.j41(0,"mat-option",21),o.EFF(1),o.k0s()),2&e){const i=c.$implicit;o.Y8G("value",i.id),o.R7$(),o.SpI(" ",i.name," ")}}function T(e,c){if(1&e&&(o.j41(0,"mat-option",21),o.EFF(1),o.k0s()),2&e){const i=c.$implicit;o.Y8G("value",i.id),o.R7$(),o.SpI(" ",i.numeroLocal," ")}}function Y(e,c){if(1&e&&(o.j41(0,"mat-option",21),o.EFF(1),o.k0s()),2&e){const i=c.$implicit;o.Y8G("value",i.id),o.R7$(),o.SpI(" ",i.nombre," ")}}function D(e,c){if(1&e&&(o.j41(0,"mat-option",21),o.EFF(1),o.k0s()),2&e){const i=c.$implicit;o.Y8G("value",i.id),o.R7$(),o.SpI(" ",i.nombre," ")}}function O(e,c){if(1&e&&(o.j41(0,"mat-option",21),o.EFF(1),o.k0s()),2&e){const i=c.$implicit;o.Y8G("value",i.id),o.R7$(),o.SpI(" ",i.nombre," ")}}function U(e,c){1&e&&(o.j41(0,"mat-error"),o.EFF(1," Solo se permiten n\xfameros. "),o.k0s())}function X(e,c){if(1&e&&(o.j41(0,"mat-option",21),o.EFF(1),o.k0s()),2&e){const i=c.$implicit;o.Y8G("value",i),o.R7$(),o.SpI(" ",i," ")}}const y=[{path:"",component:(()=>{class e{constructor(i,s,a,l,n,m,L,V){this.fb=i,this.serviciosService=s,this.localesService=a,this.usersService=l,this.uploadDataService=n,this.ordenServicioService=m,this.router=L,this.listadoSolicitudAprobacionCorrectivaService=V,this.inspectores=[],this.locales=[],this.especialidades=[],this.criticidades=[{id:1,nombre:"Alta"},{id:2,nombre:"Media"},{id:3,nombre:"Baja"}],this.afectas=[{id:1,nombre:"Seguridad"},{id:2,nombre:"Servicio"},{id:3,nombre:"Calidad"}],this.tiempos=[],this.loading=!1,this.tiempos=Array.from({length:720},(M,B)=>B+1)}ngOnInit(){this.programacionForm=this.fb.group({inspectorId:[null,r.k0.required],numeroLocal:[null,r.k0.required],especialidad:[null,r.k0.required],criticidad:[null,r.k0.required],costoEstimado:[null,[r.k0.required,r.k0.pattern(/^\$?[0-9]+(\.[0-9]{3})*$/)]],observaciones:[null,r.k0.required],afecta:[null,r.k0.required],tiempoEstimado:[null,r.k0.required],file:[null,r.k0.required]}),this.servicios(),this.getLocales(),this.getUsers()}getUsers(){this.usersService.getUsers().subscribe(i=>{this.inspectores=i})}getLocales(){this.localesService.getLocales().subscribe(i=>{this.locales=i})}servicios(){this.serviciosService.getAllServicios().subscribe(i=>{this.especialidades=i})}formatCurrency(){const i=this.programacionForm.get("costoEstimado");if(i){const s=parseInt(i.value.replace(/[^0-9]+/g,""),10);isNaN(s)?i.setValue(""):i.setValue(`$${s.toLocaleString("de-DE")}`)}}onSubmit(){if(this.programacionForm.invalid)return void p().fire({icon:"error",title:"Error",text:"Por favor, complete todos los campos requeridos"});this.loading=!0;const i=this.programacionForm.value.file,s=new FormData;s.append("file",i),this.uploadDataService.uploadFile(s,"solicitud-aprobacion-correctiva").subscribe({next:a=>{const l=a.url,n={...this.programacionForm.value};n.costoEstimado&&(n.costoEstimado=parseInt(n.costoEstimado.replace(/[^0-9]+/g,""),10)),n.file=l,this.listadoSolicitudAprobacionCorrectivaService.createSolicitudAprobacionCorrectiva(n).subscribe(m=>{console.log("solicitud creada",m)}),this.ordenServicioService.createSolicitudCorrectiva(n).subscribe({next:m=>{p().fire({icon:"success",title:"\xc9xito",text:"Solicitud creada correctamente"}).then(()=>{this.router.navigate(["/transacciones/listado-solicitud-aprobacion-correctiva"])})},error:m=>{console.error("Error al crear la solicitud:",m),p().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al crear la solicitud"}),this.loading=!1}})},error:a=>{console.error("Error al subir el archivo:",a),p().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al subir el archivo"}),this.loading=!1}})}onFileSelected(i){const s=i.target.files[0];s&&(this.programacionForm.patchValue({file:s}),this.programacionForm.get("file")?.updateValueAndValidity())}static#o=this.\u0275fac=function(s){return new(s||e)(o.rXU(r.ok),o.rXU(j.P),o.rXU(A.R),o.rXU($.g),o.rXU(k.l),o.rXU(I.A),o.rXU(N.Ix),o.rXU(R.Y))};static#i=this.\u0275cmp=o.VBU({type:e,selectors:[["app-solicitud-aprobacion-correctiva"]],standalone:!0,features:[o.aNF],decls:78,vars:10,consts:[[1,"cardWithShadow"],[1,"p-24"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-sm-4","d-flex","align-items-center"],[1,"mat-subtitle-2","f-w-600","d-block","m-b-16"],[1,"col-sm-8"],["appearance","outline",1,"w-100"],["formControlName","inspectorId","placeholder","Seleccionar Inspector"],[3,"value",4,"ngFor","ngForOf"],["formControlName","numeroLocal","placeholder","Seleccionar N\xfamero Local"],["formControlName","especialidad","placeholder","Seleccionar Especialidad"],["formControlName","criticidad","placeholder","Seleccionar Criticidad"],["formControlName","afecta","placeholder","Seleccionar Afecta a"],["matInput","","formControlName","costoEstimado","placeholder","Ingrese Costo Estimado",3,"blur"],[4,"ngIf"],["formControlName","tiempoEstimado","placeholder","Seleccionar Tiempo Estimado"],["matInput","","formControlName","observaciones","placeholder","Ingrese observaciones","rows","4"],["type","file","accept",".png, .jpg, .jpeg",3,"change"],[1,"row","justify-content-end"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(s,a){if(1&s&&(o.j41(0,"mat-card",0)(1,"mat-card-content",1)(2,"form",2),o.bIt("ngSubmit",function(){return a.onSubmit()}),o.j41(3,"div",3)(4,"div",4)(5,"mat-label",5),o.EFF(6,"Nombre Inspector"),o.k0s()(),o.j41(7,"div",6)(8,"mat-form-field",7)(9,"mat-select",8),o.DNE(10,G,2,2,"mat-option",9),o.k0s()()()(),o.j41(11,"div",3)(12,"div",4)(13,"mat-label",5),o.EFF(14,"N\xfamero Local"),o.k0s()(),o.j41(15,"div",6)(16,"mat-form-field",7)(17,"mat-select",10),o.DNE(18,T,2,2,"mat-option",9),o.k0s()()()(),o.j41(19,"div",3)(20,"div",4)(21,"mat-label",5),o.EFF(22,"Especialidad"),o.k0s()(),o.j41(23,"div",6)(24,"mat-form-field",7)(25,"mat-select",11),o.DNE(26,Y,2,2,"mat-option",9),o.k0s()()()(),o.j41(27,"div",3)(28,"div",4)(29,"mat-label",5),o.EFF(30,"Criticidad"),o.k0s()(),o.j41(31,"div",6)(32,"mat-form-field",7)(33,"mat-select",12),o.DNE(34,D,2,2,"mat-option",9),o.k0s()()()(),o.j41(35,"div",3)(36,"div",4)(37,"mat-label",5),o.EFF(38,"Afecta a"),o.k0s()(),o.j41(39,"div",6)(40,"mat-form-field",7)(41,"mat-select",13),o.DNE(42,O,2,2,"mat-option",9),o.k0s()()()(),o.j41(43,"div",3)(44,"div",4)(45,"mat-label",5),o.EFF(46,"Costo Estimado"),o.k0s()(),o.j41(47,"div",6)(48,"mat-form-field",7)(49,"input",14),o.bIt("blur",function(){return a.formatCurrency()}),o.k0s(),o.DNE(50,U,2,0,"mat-error",15),o.k0s()()(),o.j41(51,"div",3)(52,"div",4)(53,"mat-label",5),o.EFF(54,"Tiempo Estimado"),o.k0s()(),o.j41(55,"div",6)(56,"mat-form-field",7)(57,"mat-select",16),o.DNE(58,X,2,2,"mat-option",9),o.k0s()()()(),o.j41(59,"div",3)(60,"div",4)(61,"mat-label",5),o.EFF(62,"Observaciones"),o.k0s()(),o.j41(63,"div",6)(64,"mat-form-field",7),o.nrm(65,"textarea",17),o.k0s()()(),o.j41(66,"div",3)(67,"div",4)(68,"mat-label",5),o.EFF(69,"Subir Im\xe1genes"),o.k0s()(),o.j41(70,"div",6)(71,"input",18),o.bIt("change",function(n){return a.onFileSelected(n)}),o.k0s(),o.j41(72,"small"),o.EFF(73,"Formato de im\xe1genes admitido png, jpg, jpeg"),o.k0s()()(),o.j41(74,"div",19)(75,"div",6)(76,"button",20),o.EFF(77),o.k0s()()()()()()),2&s){let l;o.R7$(2),o.Y8G("formGroup",a.programacionForm),o.R7$(8),o.Y8G("ngForOf",a.inspectores),o.R7$(8),o.Y8G("ngForOf",a.locales),o.R7$(8),o.Y8G("ngForOf",a.especialidades),o.R7$(8),o.Y8G("ngForOf",a.criticidades),o.R7$(8),o.Y8G("ngForOf",a.afectas),o.R7$(8),o.Y8G("ngIf",null==(l=a.programacionForm.get("costoEstimado"))?null:l.hasError("pattern")),o.R7$(8),o.Y8G("ngForOf",a.tiempos),o.R7$(18),o.Y8G("disabled",a.loading),o.R7$(),o.SpI(" ",a.loading?"Enviando...":"Enviar"," ")}},dependencies:[u.MD,u.Sq,u.bT,g.fS,g.fg,d.rl,d.nJ,d.TL,r.YN,r.qT,r.me,r.BC,r.cb,r.X1,r.j4,r.JD,v.Hu,v.RN,v.m2,d.RG,F.Ve,F.VO,h.wT,b.Hl,b.$z,E.m_,S.X6,h.WX]})}return e})(),data:{title:"Generar solicitud de aprobaci\xf3n de actividad correctiva"}}]}}]);