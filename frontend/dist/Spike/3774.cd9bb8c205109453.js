"use strict";(self.webpackChunkSpike=self.webpackChunkSpike||[]).push([[3774],{1393:(Z,b,s)=>{s.r(b),s.d(b,{TECNICOS_ROUTES:()=>J});var h=s(177),r=s(9417),E=s(6695),_=s(2042),l=s(9159),k=s(9164),P=s(8032),d=s.n(P),T=s(9213),t=s(3953),F=s(2902),j=s(5386),S=s(4006),g=s(8887),u=s(3719),C=s(9631),w=s(9115),m=s(5596),M=s(1997),p=s(8834),$=s(4823);function x(n,c){1&n&&(t.j41(0,"th",26),t.EFF(1," Nombre "),t.k0s())}function R(n,c){if(1&n&&(t.j41(0,"td",27),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.Lme(" ",e.name," ",e.lastName," ")}}function N(n,c){1&n&&(t.j41(0,"th",26),t.EFF(1," Apellido "),t.k0s())}function y(n,c){if(1&n&&(t.j41(0,"td",27),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.SpI(" ",e.lastName," ")}}function D(n,c){1&n&&(t.j41(0,"th",26),t.EFF(1," Rut "),t.k0s())}function O(n,c){if(1&n&&(t.j41(0,"td",27),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.SpI(" ",e.rut," ")}}function G(n,c){1&n&&(t.j41(0,"th",26),t.EFF(1," Email "),t.k0s())}function I(n,c){if(1&n&&(t.j41(0,"td",27),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.R7$(),t.SpI(" ",e.email," ")}}function B(n,c){1&n&&(t.j41(0,"th",26),t.EFF(1," Acciones "),t.k0s())}function V(n,c){if(1&n){const e=t.RV6();t.j41(0,"td",27)(1,"button",28),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG();return t.Njj(a.editar(i))}),t.j41(2,"mat-icon"),t.EFF(3,"edit"),t.k0s()(),t.j41(4,"button",29),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG();return t.Njj(a.eliminar(i))}),t.j41(5,"mat-icon"),t.EFF(6,"delete"),t.k0s()(),t.j41(7,"button",30),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG();return t.Njj(a.cargarClientes(i))}),t.j41(8,"mat-icon"),t.EFF(9,"business"),t.k0s()(),t.j41(10,"button",28),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG();return t.Njj(a.cambiarPassword(i))}),t.j41(11,"mat-icon"),t.EFF(12,"lock"),t.k0s()()()}if(2&n){t.XpG();const e=t.sdS(30);t.R7$(),t.Y8G("matTooltip","Editar t\xe9cnico"),t.R7$(3),t.Y8G("matTooltip","Eliminar t\xe9cnico"),t.R7$(3),t.Y8G("matTooltip","Ver clientes asignados")("matMenuTriggerFor",e),t.R7$(3),t.Y8G("matTooltip","Cambiar contrase\xf1a")}}function X(n,c){1&n&&t.nrm(0,"tr",31)}function Y(n,c){1&n&&t.nrm(0,"tr",32)}function U(n,c){if(1&n&&(t.j41(0,"div",33),t.nrm(1,"img",34),t.j41(2,"span",35),t.EFF(3),t.k0s()()),2&n){const e=c.$implicit;t.R7$(),t.Y8G("src",e.logo||"assets/images/no-logo.png",t.B4B)("alt",e.nombre),t.R7$(2),t.JRh(e.nombre)}}function L(n,c){1&n&&(t.j41(0,"div",36),t.EFF(1," No hay clientes asignados "),t.k0s())}function z(n,c){1&n&&(t.j41(0,"mat-error"),t.EFF(1,"La contrase\xf1a es requerida"),t.k0s())}function H(n,c){1&n&&(t.j41(0,"mat-error"),t.EFF(1,"Las contrase\xf1as no coinciden"),t.k0s())}const J=[{path:"",component:(()=>{class n{constructor(e,o,i,a){this.tecnicosService=e,this.authService=o,this.dialog=i,this.router=a,this.displayedColumns=["nombre","rut","email","acciones"],this.dataSource=new l.I6,this.clientesDelTecnico=[]}ngOnInit(){this.loadTecnicos()}loadTecnicos(){this.tecnicosService.getTecnicos().subscribe(e=>{this.dataSource.data=e,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})}applyFilter(e){this.dataSource.filter=e.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}editar(e){this.router.navigate(["/mantenedores/cliente-usuarios/editar",e.id])}eliminar(e){d().fire({title:"\xbfEst\xe1s seguro?",text:"Esta acci\xf3n no se puede deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xed, eliminar"}).then(o=>{o.isConfirmed&&this.tecnicosService.deleteTecnico(e.id).subscribe(()=>{this.dataSource.data=this.dataSource.data.filter(i=>i.id!==e.id),d().fire("Eliminado","El t\xe9cnico ha sido eliminado","success")})})}openCrearTecnicoModal(){this.router.navigate(["/mantenedores/cliente-usuarios"])}agregarDocumento(e){this.router.navigate(["/mantenedores/documentos/subir-documento",{tipo:3,tecnico:e.id,cliente:null,repuesto:null,vehiculo:null}])}cambiarPassword(e){this.router.navigate(["/mantenedores/usuarios/cambiar-password",{tecnico:e.id}])}cargarClientes(e){this.clientesDelTecnico=[],this.tecnicosService.getTecnicoClientes(e.id).subscribe({next:o=>{this.clientesDelTecnico=o},error:o=>{console.error("Error al cargar clientes:",o),this.clientesDelTecnico=[]}})}verClientes(e){this.tecnicosService.getTecnicoClientes(e.id).subscribe({next:o=>{const i=o.map(a=>`<div class="cliente-item">\n             <img src="${a.logo}" alt="${a.nombre}" style="width: 30px; height: 30px; margin-right: 10px; border-radius: 50%;">\n             <span>${a.nombre}</span>\n           </div>`).join("");d().fire({title:`Clientes asignados a ${e.name} ${e.lastName}`,html:o.length?`<div class="clientes-grid">${i}</div>`:"<p>No hay clientes asignados</p>",customClass:{container:"clientes-modal"}})},error:o=>{d().fire({title:"Error",text:"No se pudieron cargar los clientes",icon:"error"})}})}static#t=this.\u0275fac=function(o){return new(o||n)(t.rXU(F.q),t.rXU(j.u),t.rXU(S.bZ),t.rXU(g.Ix))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-tecnicos"]],viewQuery:function(o,i){if(1&o&&(t.GBs(E.iy,5),t.GBs(_.B4,5)),2&o){let a;t.mGM(a=t.lsd())&&(i.paginator=a.first),t.mGM(a=t.lsd())&&(i.sort=a.first)}},standalone:!0,features:[t.aNF],decls:38,vars:5,consts:[["input",""],["clientesMenu","matMenu"],[1,"cardWithShadow"],[1,"p-24"],[1,"row","justify-content-between","m-b-8"],[1,"col-sm-4","col-lg-3"],["mat-flat-button","","color","primary",3,"click"],["appearance","outline",1,"w-100","hide-hint"],["matInput","","placeholder","Buscar",3,"keyup"],[1,"table-responsive","m-t-30"],["mat-table","",1,"w-100","mat-elevation-z8",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","","class","f-w-600 mat-subtitle-1 f-s-14 p-l-0",4,"matHeaderCellDef"],["mat-cell","","class","p-l-0",4,"matCellDef"],["matColumnDef","apellido"],["matColumnDef","rut"],["matColumnDef","email"],["matColumnDef","acciones"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"clientes-menu"],[1,"clientes-container",3,"click"],[1,"menu-title"],[1,"clientes-list"],["class","cliente-item",4,"ngFor","ngForOf"],["class","no-clientes",4,"ngIf"],["mat-header-cell","",1,"f-w-600","mat-subtitle-1","f-s-14","p-l-0"],["mat-cell","",1,"p-l-0"],["mat-icon-button","","color","primary","matTooltipPosition","above",3,"click","matTooltip"],["mat-icon-button","","color","warn","matTooltipPosition","above",3,"click","matTooltip"],["mat-icon-button","","color","primary","matTooltipPosition","above",3,"click","matTooltip","matMenuTriggerFor"],["mat-header-row",""],["mat-row",""],[1,"cliente-item"],[1,"cliente-logo",3,"src","alt"],[1,"cliente-nombre"],[1,"no-clientes"]],template:function(o,i){if(1&o){const a=t.RV6();t.j41(0,"mat-card",2)(1,"mat-card-content",3)(2,"div",4)(3,"div",5)(4,"button",6),t.bIt("click",function(){return t.eBV(a),t.Njj(i.openCrearTecnicoModal())}),t.EFF(5,"Nuevo Usuario\xa0del\xa0sistema"),t.k0s()(),t.j41(6,"div",5)(7,"mat-form-field",7)(8,"input",8,0),t.bIt("keyup",function(v){return t.eBV(a),t.Njj(i.applyFilter(v))}),t.k0s()()()(),t.j41(10,"div",9)(11,"table",10),t.qex(12,11),t.DNE(13,x,2,0,"th",12)(14,R,2,2,"td",13),t.bVm(),t.qex(15,14),t.DNE(16,N,2,0,"th",12)(17,y,2,1,"td",13),t.bVm(),t.qex(18,15),t.DNE(19,D,2,0,"th",12)(20,O,2,1,"td",13),t.bVm(),t.qex(21,16),t.DNE(22,G,2,0,"th",12)(23,I,2,1,"td",13),t.bVm(),t.qex(24,17),t.DNE(25,B,2,0,"th",12)(26,V,13,5,"td",13),t.bVm(),t.DNE(27,X,1,0,"tr",18)(28,Y,1,0,"tr",19),t.k0s()()()(),t.j41(29,"mat-menu",20,1)(31,"div",21),t.bIt("click",function(v){return t.eBV(a),t.Njj(v.stopPropagation())}),t.j41(32,"h4",22),t.EFF(33,"Clientes Asignados"),t.k0s(),t.nrm(34,"mat-divider"),t.j41(35,"div",23),t.DNE(36,U,4,3,"div",24)(37,L,2,0,"div",25),t.k0s()()()}2&o&&(t.R7$(11),t.Y8G("dataSource",i.dataSource),t.R7$(16),t.Y8G("matHeaderRowDef",i.displayedColumns),t.R7$(),t.Y8G("matRowDefColumns",i.displayedColumns),t.R7$(8),t.Y8G("ngForOf",i.clientesDelTecnico),t.R7$(),t.Y8G("ngIf",!(null!=i.clientesDelTecnico&&i.clientesDelTecnico.length)))},dependencies:[h.MD,h.Sq,h.bT,k.G,u.rl,C.fg,w.kk,w.Cp,m.RN,m.m2,M.q,p.$z,p.iY,T.An,$.oV,l.Zl,l.tL,l.ji,l.cC,l.YV,l.iL,l.KS,l.$R,l.YZ,l.NB,r.X1,T.m_],styles:[".clientes-menu .mat-mdc-menu-content{padding:0!important}.clientes-container[_ngcontent-%COMP%]{min-width:250px;max-width:350px;padding:0}.clientes-container[_ngcontent-%COMP%]   .menu-title[_ngcontent-%COMP%]{margin:0;padding:16px;font-size:16px;font-weight:500;color:#000000de}.clientes-container[_ngcontent-%COMP%]   .clientes-list[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;padding:8px}.clientes-container[_ngcontent-%COMP%]   .clientes-list[_ngcontent-%COMP%]   .cliente-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px;gap:12px;transition:background-color .2s}.clientes-container[_ngcontent-%COMP%]   .clientes-list[_ngcontent-%COMP%]   .cliente-item[_ngcontent-%COMP%]:hover{background-color:#0000000a}.clientes-container[_ngcontent-%COMP%]   .clientes-list[_ngcontent-%COMP%]   .cliente-item[_ngcontent-%COMP%]   .cliente-logo[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;object-fit:cover;background-color:#f5f5f5}.clientes-container[_ngcontent-%COMP%]   .clientes-list[_ngcontent-%COMP%]   .cliente-item[_ngcontent-%COMP%]   .cliente-nombre[_ngcontent-%COMP%]{font-size:14px;color:#000000de}.clientes-container[_ngcontent-%COMP%]   .clientes-list[_ngcontent-%COMP%]   .no-clientes[_ngcontent-%COMP%]{padding:16px;text-align:center;color:#0000008a;font-style:italic}"]})}return n})(),data:{title:"Usuarios del sistema"}},{path:"cambiar-password",component:(()=>{class n{constructor(e,o,i,a,f){this.fb=e,this.authService=o,this.route=i,this.router=a,this.tecnicosService=f,this.password="",this.password2="",this.form=this.fb.group({username:[""],password:["",r.k0.required],password2:["",r.k0.required]},{validator:this.passwordsMatchValidator})}ngOnInit(){this.tecnico=this.route.snapshot.params.tecnico,this.tecnicosService.getTecnico(this.tecnico).subscribe(e=>{this.tecnicoProfile=e.profile})}passwordsMatchValidator(e){return e.get("password")?.value===e.get("password2")?.value?null:{mismatch:!0}}onCancel(){this.router.navigate("tecnico"===this.tecnicoProfile?["/mantenedores/tecnicos-gruman"]:["/mantenedores/usuarios"])}cambiarPassword(){if(this.form.valid){const e=this.form.get("password")?.value;this.authService.changePassword(this.tecnico,e).subscribe(()=>{d().fire({icon:"success",title:"Contrase\xf1a cambiada correctamente",showConfirmButton:!1,timer:1500}),this.router.navigate("tecnico"===this.tecnicoProfile?["/mantenedores/tecnicos-gruman"]:["/mantenedores/usuarios"])})}else d().fire({icon:"error",title:"Oops...",text:"Las contrase\xf1as no coinciden!"})}static#t=this.\u0275fac=function(o){return new(o||n)(t.rXU(r.ok),t.rXU(j.u),t.rXU(g.nX),t.rXU(g.Ix),t.rXU(F.q))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-cambiar-password"]],standalone:!0,features:[t.aNF],decls:28,vars:4,consts:[[1,"cardWithShadow"],[1,"m-b-0"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-sm-4","d-flex","align-items-center"],[1,"mat-subtitle-2","f-w-600","d-block","m-b-16"],[1,"col-sm-8"],["appearance","outline",1,"w-100"],["matInput","","type","password","formControlName","password","placeholder","Ingrese la nueva contrase\xf1a","autocomplete","new-password","required",""],["matInput","","type","password","formControlName","password2","placeholder","Repita la nueva contrase\xf1a","autocomplete","new-password","required",""],[1,"row","justify-content-end"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"]],template:function(o,i){if(1&o&&(t.j41(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title",1),t.EFF(3,"Cambiar Contrase\xf1a"),t.k0s()(),t.j41(4,"mat-card-content")(5,"form",2),t.bIt("ngSubmit",function(){return i.cambiarPassword()}),t.j41(6,"div",3)(7,"div",4)(8,"mat-label",5),t.EFF(9,"Nueva Contrase\xf1a"),t.k0s()(),t.j41(10,"div",6)(11,"mat-form-field",7),t.nrm(12,"input",8),t.DNE(13,z,2,0,"mat-error"),t.k0s()()(),t.j41(14,"div",3)(15,"div",4)(16,"mat-label",5),t.EFF(17,"Repetir Contrase\xf1a"),t.k0s()(),t.j41(18,"div",6)(19,"mat-form-field",7),t.nrm(20,"input",9),t.DNE(21,H,2,0,"mat-error"),t.k0s()()(),t.j41(22,"div",10)(23,"div",6)(24,"button",11),t.bIt("click",function(){return i.onCancel()}),t.EFF(25,"Cancelar"),t.k0s(),t.j41(26,"button",12),t.EFF(27,"Cambiar Contrase\xf1a"),t.k0s()()()()()()),2&o){let a;t.R7$(5),t.Y8G("formGroup",i.form),t.R7$(8),t.vxM(null!=(a=i.form.get("password"))&&a.invalid?13:-1),t.R7$(8),t.vxM(i.form.hasError("mismatch")?21:-1),t.R7$(5),t.Y8G("disabled",i.form.invalid)}},dependencies:[r.YN,r.qT,r.me,r.BC,r.cb,r.YS,m.Hu,m.RN,m.m2,m.MM,m.dh,r.X1,r.j4,r.JD,u.RG,u.rl,u.nJ,u.TL,C.fS,C.fg,p.Hl,p.$z]})}return n})(),data:{title:"Cambiar Password"}}]}}]);