<mat-card class="cardWithShadow">
  <mat-card-header>
    <form [formGroup]="informeForm" class="d-flex align-items-baseline gap-10">
      <mat-form-field appearance="outline">
        <mat-label>Selecciona cliente</mat-label>
        <input
          type="text"
          placeholder="Selecciona cliente"
          aria-label="Number"
          matInput
          formControlName="cliente"
          [matAutocomplete]="auto"
        />
        <button
          mat-icon-button
          matSuffix
          *ngIf="informeForm.get('cliente')?.value"
          (click)="clearClient()"
        >
          <mat-icon>close</mat-icon>
        </button>
        <mat-autocomplete
          #auto="matAutocomplete"
          [autoActiveFirstOption]="true"
          [displayWith]="displayFn"
          (optionSelected)="onCompanySelected($event)"
        >
          <mat-option
            *ngFor="let cliente of filteredOptions | async"
            [value]="cliente.id"
          >
            {{ cliente.nombre }}
          </mat-option>
        </mat-autocomplete>
        <mat-error *ngIf="informeForm.get('cliente')?.hasError('required')">
          Campo requerido
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Selecciona mes facturacion</mat-label>
        <input
          type="text"
          placeholder="Selecciona un mes"
          aria-label="Number"
          matInput
          formControlName="mesFacturacion"
          [matAutocomplete]="mesFacturacion"
        />
        <button
          mat-icon-button
          matSuffix
          *ngIf="informeForm.get('cliente')?.value"
          (click)="clearMes()"
        >
          <mat-icon>close</mat-icon>
        </button>
        <mat-autocomplete
          autoActiveFirstOption
          #mesFacturacion="matAutocomplete"
          [displayWith]="displayMesFn"
          (optionSelected)="onMesFacturacionSelected($event)"
        >
          @for(mes of mesFacturacionList; track mes) {
          <mat-option [value]="mes">
            {{ mes.mes }}
          </mat-option>
          }
        </mat-autocomplete>
        <mat-error
          *ngIf="informeForm.get('mesFacturacion')?.hasError('required')"
        >
          Campo requerido
        </mat-error>
      </mat-form-field>

      <button
        mat-raised-button
        color="primary"
        class="mt-2"
        (click)="setFilter()"
        [disabled]="informeForm.invalid"
      >
        Buscar
      </button>
    </form>
  </mat-card-header>

  <mat-card-content class="p-24">
    <div class="table-responsive">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 w-100">
        <!-- Requerimiento Column -->
        <ng-container matColumnDef="requerimiento">
          <th mat-header-cell *matHeaderCellDef>Requerimiento</th>
          <td
            mat-cell
            *matCellDef="let element"
            [matTooltip]="element.requerimiento"
            matTooltipPosition="above"
            class="text-truncate"
          >
            {{ element.requerimiento }}
          </td>
        </ng-container>

        <!-- Servicio Column -->
        <ng-container matColumnDef="tipo_servicio">
          <th mat-header-cell *matHeaderCellDef>Servicio</th>
          <td
            mat-cell
            *matCellDef="let element"
            [matTooltip]="element.tipo_servicio"
            matTooltipPosition="above"
            class="text-truncate"
          >
            {{ element.tipo_servicio }}
          </td>
        </ng-container>

        <!-- Local Column -->
        <ng-container matColumnDef="local">
          <th mat-header-cell *matHeaderCellDef>Local</th>
          <td
            mat-cell
            *matCellDef="let element"
            [matTooltip]="element.local"
            matTooltipPosition="above"
            class="text-truncate"
          >
            {{ element.local }}
          </td>
        </ng-container>

        <!-- Repuesto Column -->
        <ng-container matColumnDef="repuesto">
          <th mat-header-cell *matHeaderCellDef>Repuesto</th>
          <td
            mat-cell
            *matCellDef="let element"
            [matTooltip]="element.repuesto"
            matTooltipPosition="above"
            class="text-truncate"
            style="max-width: 150px; white-space: nowrap"
          >
            {{ element.repuesto }}
          </td>
        </ng-container>

        <!-- Cliente Column -->
        <ng-container matColumnDef="cliente">
          <th mat-header-cell *matHeaderCellDef>Cliente</th>
          <td
            mat-cell
            *matCellDef="let element"
            [matTooltip]="element.cliente"
            matTooltipPosition="above"
            class="text-truncate"
            style="max-width: 150px; white-space: nowrap"
          >
            {{ element.cliente }}
          </td>
        </ng-container>

        <!-- Cantidad Column -->
        <ng-container matColumnDef="cantidad">
          <th mat-header-cell *matHeaderCellDef>Cantidad</th>
          <td mat-cell *matCellDef="let element">{{ element.cantidad }}</td>
        </ng-container>

        <!-- Precio Compra Column -->
        <ng-container matColumnDef="precio_compra">
          <th mat-header-cell *matHeaderCellDef>Precio&nbsp;compra</th>
          <td mat-cell *matCellDef="let element">
            ${{ element.precio_compra }}
          </td>
        </ng-container>

        <!-- Precio Venta Column -->
        <ng-container matColumnDef="precio_venta_cliente">
          <th mat-header-cell *matHeaderCellDef>Precio Venta</th>
          <td mat-cell *matCellDef="let element">
            ${{
              element.precio_venta_cliente | currency : "" : "symbol" : "1.0-0"
            }}
          </td>
        </ng-container>

        <!-- Valor Column -->
        <ng-container matColumnDef="valor_cliente">
          <th mat-header-cell *matHeaderCellDef>Valor</th>
          <td mat-cell *matCellDef="let element">
            ${{ element.valor_cliente }}
          </td>
        </ng-container>

        <!-- Fecha Column -->
        <ng-container matColumnDef="fechaVisita">
          <th mat-header-cell *matHeaderCellDef>Fecha</th>
          <td
            mat-cell
            *matCellDef="let element"
            matTooltipPosition="above"
            class="text-truncate"
            style="max-width: 150px; white-space: nowrap"
          >
            {{ element.fechaVisita | date : "dd-MM-yyyy" }}
          </td>
        </ng-container>

        <!-- Mes Facturacion Column -->
        <ng-container matColumnDef="mes_facturacion">
          <th mat-header-cell *matHeaderCellDef>Mes Facturacion</th>
          <td mat-cell *matCellDef="let element">
            {{ element.mes_facturacion }}
          </td>
        </ng-container>

        <!-- Visita Tecnico Column -->
        <ng-container matColumnDef="nombre_tecnico">
          <th mat-header-cell *matHeaderCellDef>Visita TÃ©cnico</th>
          <td
            mat-cell
            *matCellDef="let element"
            [matTooltip]="element.nombre_tecnico"
            matTooltipPosition="above"
            class="text-truncate"
            style="max-width: 150px; white-space: nowrap"
          >
            {{ element.nombre_tecnico }}
          </td>
        </ng-container>

        <tr
          mat-header-row
          *matHeaderRowDef="displayedColumns"
          class="w-100"
        ></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="w-100"
        ></tr>
      </table>
    </div>
    <mat-paginator
      [pageSizeOptions]="[5, 10, 25, 100]"
      class="mt-10"
      aria-label="Select page of users"
    ></mat-paginator>
  </mat-card-content>
</mat-card>
